---
title: åˆ·è„¸ç­¾åˆ°ç³»ç»Ÿå›é¡¾
date: 2017-01-19 19:09:14
categories:
tags: [react, redux, webpack, express, nodejs, äººè„¸è¯†åˆ«, https]
cover: https://ooo.0o0.ooo/2017/01/19/5880a68dc28c2.jpg
skip: false
---

[æ¯•è®¾ ğŸ‘‰ å—å¸ˆå¤§åˆ·è„¸ç­¾åˆ°ç³»ç»Ÿ ğŸ‘‰  face.moyuyc.xyz](https://face.moyuyc.xyz)
![](https://ooo.0o0.ooo/2017/01/18/587eea50913fd.jpg)

æºç ï¼š[graduation-project](https://github.com/moyuyc/graduation-project)

å†™è¯¥æ–‡æ˜¯ä¸ºäº†å‡†å¤‡å†™æ¯•ä¸šè®ºæ–‡çš„ææ–™ï¼Œæ‰€ä»¥æ–‡å­—ä»‹ç»è¾ƒå¤šï¼Œæ¯”è¾ƒé¢å‘å¤§ä¼—ç¨‹åºå‘˜ã€‚

# ä»»åŠ¡æ¦‚è¦ï¼ˆTask Summaryï¼‰

> æœ¬åˆ·è„¸ç³»ç»Ÿä¸»è¦åˆ†ä¸ºå­¦ç”Ÿç­¾åˆ°ã€äººè„¸å½•å…¥ã€ç®¡ç†å‘˜æ¨¡å—ã€‚ç®¡ç†å‘˜æ¨¡å—ï¼Œå¯ä»¥å¯¹å­¦ç”Ÿçš„äººè„¸æ ·æœ¬ï¼Œå­¦ç”Ÿç›¸ä¿¡æ“ä½œï¼›è¯¥ç³»ç»Ÿæ ¸å¿ƒæ¨¡å—ï¼šå­¦ç”Ÿç­¾åˆ°ï¼Œå°†åŠ¨æ€ç›‘æ§æ‘„åƒå¤´ï¼Œä¸€æ—¦è¯†åˆ«å‡ºäººè„¸ä¾¿å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚è¿›è¡Œé¢„å¤„ç† => äººè„¸æ£€æµ‹ => äººè„¸æ¯”å¯¹ã€‚è¯¥ç³»ç»Ÿå°†é‡‡ç”¨ Web æ¶æ„å®ç°ï¼Œå‰ç«¯ä½¿ç”¨react+redux+router+webpackæŠ€æœ¯æ ˆï¼Œç»“æ„æ¸…æ™°ï¼Œå¤ç”¨ç‡é«˜ï¼›åç«¯å°†é‡‡ç”¨ nodejs+express æ­å»ºæœåŠ¡å™¨ï¼ŒC++ å®ç°æ ¸å¿ƒäººè„¸è¯†åˆ«æ¯”å¯¹ç®—æ³•ï¼Œé€šè¿‡ js è°ƒç”¨ C++ æ ¸å¿ƒç®—æ³•ï¼›åç»­å¯ä»¥ä½¿ç”¨ electron å°†å‰ç«¯ç•Œé¢æ‰“åŒ…æˆè·¨å¹³å°appï¼Œæ–¹ä¾¿å¸ˆç”Ÿä½¿ç”¨ã€‚

# æŠ€æœ¯æ ˆï¼ˆTechnology Stackï¼‰

![](https://ooo.0o0.ooo/2017/01/21/58826eb274d3a.jpg)

ä¸‹é¢è¿›è¡Œä¸€äº›è¾ƒä¸ºç²—ç•¥çš„ä»‹ç»ï¼Œèœ»èœ“ç‚¹æ°´è¯´è¯´æ¶‰åŠçš„æŠ€æœ¯

## å‰ç«¯ï¼ˆFront-Endï¼‰

1. å•é¡µWebåº”ç”¨ï¼ˆsingle page web applicationï¼ŒSPAï¼‰ï¼Œå°±æ˜¯åªæœ‰ä¸€å¼ Webé¡µé¢çš„åº”ç”¨ã€‚å•é¡µåº”ç”¨ç¨‹åº (SPA) æ˜¯åŠ è½½å•ä¸ªHTML é¡µé¢å¹¶åœ¨ç”¨æˆ·ä¸åº”ç”¨ç¨‹åºäº¤äº’æ—¶åŠ¨æ€æ›´æ–°è¯¥é¡µé¢çš„Webåº”ç”¨ç¨‹åºã€‚ æµè§ˆå™¨ä¸€å¼€å§‹ä¼šåŠ è½½å¿…éœ€çš„HTMLã€CSSå’ŒJavaScriptï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½åœ¨è¿™å¼ é¡µé¢ä¸Šå®Œæˆï¼Œéƒ½ç”± JavaScript æ¥æ§åˆ¶ã€‚å› æ­¤ï¼Œå¯¹å•é¡µåº”ç”¨æ¥è¯´æ¨¡å—åŒ–çš„å¼€å‘å’Œè®¾è®¡æ˜¾å¾—ç›¸å½“é‡è¦ã€‚
![](https://ooo.0o0.ooo/2017/01/22/5884d672c4710.jpg)

2. ä½¿ç”¨ä¸»æµ [Webpack](https://webpack.github.io/) æ„å»ºï¼Œè¿›è¡Œå‰ç«¯æ¨¡å—è‡ªåŠ¨åŒ–ç®¡ç†ã€‚

![](https://ooo.0o0.ooo/2017/01/22/5884d5ba0680b.jpg)


3. ä½¿ç”¨Facebookæå‡ºçš„ [React](https://facebook.github.io/react/) è¿›è¡Œä½œä¸º Viewï¼Œ å°† HTML DOM è¿›è¡Œä¸Šå±‚æŠ½è±¡ï¼Œæå‡º Virtual DOM æ¦‚å¿µï¼Œä¸€å¥—ç†å¿µï¼Œå®ç°äº†Server render, Web UI, mobile UI çš„ç»Ÿä¸€ã€‚  Learn Once, Write Anywhere
![ClipboardImage](https://ooo.0o0.ooo/2017/01/23/5884d71e7ed1d.jpg)

4. [Redux](https://github.com/reactjs/redux)ï¼Œéšç€ JavaScript å•é¡µåº”ç”¨å¼€å‘æ—¥è¶‹å¤æ‚ï¼ŒJavaScript éœ€è¦ç®¡ç†æ¯”ä»»ä½•æ—¶å€™éƒ½è¦å¤šçš„ state (çŠ¶æ€)ï¼Œstate åœ¨ä»€ä¹ˆæ—¶å€™ï¼Œç”±äºä»€ä¹ˆåŸå› ï¼Œå¦‚ä½•å˜åŒ–å·²ç„¶ä¸å—æ§åˆ¶ã€‚ å½“ç³»ç»Ÿå˜å¾—é”™ç»¼å¤æ‚çš„æ—¶å€™ï¼Œæƒ³é‡ç°é—®é¢˜æˆ–è€…æ·»åŠ æ–°åŠŸèƒ½å°±ä¼šå˜å¾—ä¸¾æ­¥ç»´è‰°, Reduxåˆ™æ˜¯ä¸ºäº†è§£å†³è¯¥ç—›ç‚¹è€Œäº§ç”Ÿã€‚
5. [React Router](https://github.com/ReactTraining/react-router) æ˜¯ä¸€ä¸ªåŸºäº React ä¹‹ä¸Šçš„å¼ºå¤§è·¯ç”±åº“ï¼Œå®ƒå¯ä»¥è®©ä½ å‘åº”ç”¨ä¸­å¿«é€Ÿåœ°æ·»åŠ è§†å›¾å’Œæ•°æ®æµï¼Œæ—¢ä¿è¯äº†å•é¡µåº”ç”¨çš„ç•…å¿«ï¼ŒåŒæ—¶ä¿æŒé¡µé¢ä¸ URL é—´çš„åŒæ­¥ã€‚
![](https://ooo.0o0.ooo/2017/01/23/5884d88d62dd5.jpg)
6. *[Babel](https://babeljs.io/) => ä½¿ç”¨ JavaScript å®ç°çš„ç¼–è¯‘å™¨ï¼Œæ­£å¦‚å®˜ç½‘æ‰€è¯´çš„é‚£æ · Use next generation JavaScript, today.
 ï¼Œå¯ä»¥åˆ©ç”¨ Babel ä¹¦å†™æœ€æ–°çš„ JavasScript è¯­æ³•æ ‡å‡†ï¼Œå¦‚ ECMAScript 6 ï¼Œæ­é… Webpack ä½¿ç”¨æ›´ä½³ã€‚
7. *[ECMAScript6](http://es6-features.org/) => 2015 å¹´æå‡ºçš„JavaScriptæ ‡å‡†ï¼Œç›®æ ‡æ˜¯ä½¿å¾—JavaScriptè¯­è¨€å¯ä»¥ç”¨æ¥ç¼–å†™å¤æ‚çš„å¤§å‹åº”ç”¨ç¨‹åºï¼Œæˆä¸ºä¼ä¸šçº§å¼€å‘è¯­è¨€ã€‚ECMAScriptå’ŒJavaScriptçš„å…³ç³»æ˜¯ï¼Œå‰è€…æ˜¯åè€…çš„è§„æ ¼ï¼Œåè€…æ˜¯å‰è€…çš„ä¸€ç§å®ç°ã€‚ES 6 å…·æœ‰ä¸€ç³»åˆ—ç®€æ˜çš„è¯­æ³•ç³–ï¼Œæ›´ä½³çš„ä¹¦å†™ä½“éªŒã€‚ä½†ä¸ºäº†ä¿è¯æµè§ˆå™¨, Node ç¯å¢ƒå…¼å®¹æ€§ï¼Œå¾€å¾€é…åˆ Babel ä¹¦å†™ã€‚
8. *less => ä¸€ç§ CSS é¢„å¤„ç†è¯­è¨€ï¼Œå¢åŠ äº†è¯¸å¦‚å˜é‡ã€æ··åˆï¼ˆmixinï¼‰ã€å‡½æ•°ç­‰åŠŸèƒ½ï¼Œè®© CSS æ›´æ˜“ç»´æŠ¤ã€æ–¹ä¾¿åˆ¶ä½œä¸»é¢˜ã€æ‰©å……ã€‚
9. ä½¿ç”¨ HTML5 çš„ getUserMedia æ–¹æ³•ï¼Œè°ƒç”¨è®¡ç®—æœºéŸ³é¢‘è§†é¢‘ç­‰ç¡¬ä»¶è®¾å¤‡ã€‚ä¸ºäº†å®‰å…¨é—®é¢˜ï¼ŒChrome åªèƒ½åœ¨æœ¬åœ°åœ°å€ä¸Šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¤–ç½‘åœ°å€åˆ™åªèƒ½åœ¨é€šè¿‡è¯ä¹¦æ£€æµ‹çš„ HTTPS æœåŠ¡ä¸­è°ƒç”¨ã€‚

## åç«¯ï¼ˆBack-Endï¼‰

1. é‡‡ç”¨ [nodeJs](https://nodejs.org/) ä½œä¸ºåç«¯ï¼Œé‡‡ç”¨ JavaScript è„šæœ¬è¯­è¨€å¼€å‘ã€‚ nodeJs å…·æœ‰å¼‚æ­¥äº‹ä»¶é©±åŠ¨ã€éé˜»å¡ï¼ˆnon-blockingï¼‰IO ç‰¹æ€§ï¼Œé‡‡ç”¨ Google çš„ V8 å¼•æ“æ¥æ‰§è¡Œä»£ç ã€‚
2. Node.jsä»¥å•çº¿ç¨‹è¿è¡Œï¼Œä½¿ç”¨éé˜»å¡I/Oè°ƒç”¨ï¼Œè¿™æ ·æ—¢å¯ä»¥æ”¯æŒæ•°ä»¥ä¸‡è®¡çš„å¹¶å‘è¿æ¥ï¼Œåˆä¸ä¼šå› å¤šçº¿ç¨‹æœ¬èº«çš„ç‰¹ç‚¹è€Œå¸¦æ¥éº»çƒ¦ã€‚ä¼—å¤šè¯·æ±‚åªä½¿ç”¨å•çº¿ç¨‹çš„è®¾è®¡æ„å‘³ç€å¯ä»¥ç”¨äºåˆ›å»ºé«˜å¹¶å‘åº”ç”¨ç¨‹åºã€‚Node.jsåº”ç”¨ç¨‹åºçš„è®¾è®¡ç›®æ ‡æ˜¯ä»»ä½•éœ€è¦æ“ä½œI/Oçš„å‡½æ•°éƒ½ä½¿ç”¨å›è°ƒå‡½æ•°ã€‚
è¿™ç§è®¾è®¡çš„ç¼ºç‚¹æ˜¯ï¼Œå¦‚æœä¸ä½¿ç”¨clusterã€StrongLoop Process Manageræˆ–pm2ç­‰æ¨¡å—ï¼ŒNode.jså°±éš¾ä»¥å¤„ç†å¤šæ ¸æˆ–å¤šçº¿ç¨‹ç­‰æƒ…å†µã€‚
3. pm2 => https://segmentfault.com/a/1190000004621734
4. isomorphic renderï¼ˆåŒæ„æ¸²æŸ“ï¼‰=> æŒ‡çš„æ˜¯å‰åç«¯ä½¿ç”¨åŒä¸€ä»½ä»£ç ã€‚å‰ç«¯é€šè¿‡ Webpack å®ç° CommonJs çš„æ¨¡å—è§„èŒƒï¼ˆNodeäº¦æ˜¯ CommonJs ï¼‰+ React æå‡ºçš„ JSX ï¼Œä½¿å¾— NodeJs é€šè¿‡è§£æè¯·æ±‚çš„ URLï¼Œé€‚é… react-router ä¸­çš„å‰ç«¯è·¯ç”±è§„åˆ™ï¼Œå¾—åˆ° routing Propsï¼Œè¿˜å¯ä»¥ dispatch(action) åŒæ­¥æˆ–å¼‚æ­¥ï¼ˆä¸€èˆ¬æ˜¯ isomorphic-fetch ï¼‰ï¼Œåˆæˆ–æ˜¯ç›´æ¥è¯»å–æ•°æ®ï¼Œä»è€Œæ›´æ–° store ï¼Œæœ€å nodeJs é€šè¿‡ store ä¸­çš„ state æ¸²æŸ“ JSX ï¼Œäº§ç”Ÿé™æ€çš„ HTMLï¼Œä»è€Œå®ç°äº†å‰åç«¯çš„åŒæ„æ¸²æŸ“ã€‚
![isomorphic render](https://ooo.0o0.ooo/2017/01/23/5884dc559b020.jpg) 
![isomorphic render](https://ooo.0o0.ooo/2017/01/29/588d9b8393522.jpg)
5. [nodeJs C++ Addons](https://nodejs.org/api/addons.html)ï¼ŒnodeJs å°±æ˜¯ä½¿ç”¨C++è¯­è¨€å®ç°çš„ï¼Œå›¾åƒå¤„ç†æœ€å¼ºå¤§çš„åº“ opencv ä¾¿æ˜¯ç”¨ C++ å®ç°çš„ï¼Œè¿™å°±ä¸å¾—ä¸éœ€è¦ nodeJs ä¸ C++ ä¹‹å‰é€šä¿¡ï¼Œé€šè¿‡ nodeJs è°ƒç”¨ opencv çš„æ–¹æ³•ï¼Œ[node-opencv](https://github.com/peterbraden/node-opencv) ä¾¿æ˜¯åˆ©ç”¨ [nan](https://github.com/nodejs/nan) ï¼ˆè§£å†³å¹³å°é—´å…¼å®¹æ€§é—®é¢˜ï¼Œå°†å¼‚æ­¥äº‹ä»¶é©±åŠ¨å°è£…ï¼‰ä¸ [v8](https://github.com/v8/v8) ï¼ˆjavascript å¯¹åº”çš„æ•°æ®ç±»å‹ä¸ C++æ˜ å°„ï¼‰ ï¼Œé€šè¿‡ [node-gyp](https://github.com/nodejs/node-gyp) å·¥å…·ï¼Œå°† C++ æ‰“åŒ…æˆ ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ *.nodeï¼Œé€šè¿‡ require å³å¯è°ƒç”¨ã€‚
6. [node-mysql](https://github.com/mysqljs/mysql) ï¼Œç”±äº NodeJs å…·æœ‰ non-blocking IO ä¸å¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„ç‰¹æ€§ï¼Œæ‰€ä»¥å¾ˆé€‚åˆäº IO å¯†é›†å‹é«˜å¹¶å‘ä¸šåŠ¡ï¼Œè€Œè®¿é—®æ•°æ®åº“æ­£æ˜¯å¸¸ç”¨çš„ IO æ“ä½œã€‚
7. NPMï¼ˆå…¨ç§°Node Package Managerï¼Œå³nodeåŒ…ç®¡ç†å™¨ï¼‰ï¼Œæ˜¯Nodeé¢„è®¾çš„ï¼Œé€šè¿‡å›½å†… taobao é•œåƒå¯ä»¥åŠ å¿«ä¸‹è½½é€Ÿåº¦ã€‚
8. [Express](http://expressjs.com/zh-cn/)ï¼ˆNode.js Web åº”ç”¨ç¨‹åºæ¡†æ¶ï¼‰ï¼Œå¾ˆæ–¹ä¾¿çš„å®šä¹‰ restful api.
9. Spiderï¼Œç½‘ç»œçˆ¬è™«ï¼Œé€šè¿‡è½¬å‘å®¢æˆ·ç«¯çš„ HTTP æˆ– HTTPs è¯·æ±‚ï¼Œå¾—åˆ°è¿œç¨‹æœåŠ¡å™¨çš„å“åº”æ•°æ®ï¼Œç„¶åå†ä¸€æ¬¡è½¬å‘è‡³å®¢æˆ·ç«¯ä¸­ï¼Œä¹Ÿå°±æ˜¯ä»£ç†çš„æ„æ€
![](https://ooo.0o0.ooo/2017/01/21/5882d1cb76d12.jpg)
å…³äº[å—å¸ˆå¤§çš„ä¸€äº› API](http://njnu.chaiziyi.com.cn/) ï¼Œå·²ç»æœ‰å‰äººç”¨ Python å†™è¿‡äº†ï¼Œçˆ¬å–æ•™åŠ¡ç³»ç»Ÿæ•°æ®ï¼Œç„¶åæˆ‘åªéœ€è¦çˆ¬å–å¯¹åº”çš„ç½‘ç«™å³å¯ã€‚
10. nginxï¼Œä½¿ç”¨ C++ å®ç°çš„ Web æœåŠ¡å™¨ï¼Œé€šè¿‡ç®€å•çš„é…ç½®å°±å¯ä»¥åå‘ä»£ç†è‡³æ­£ç¡®çš„ç«¯å£å’Œåº”ç”¨å±‚åè®®ã€‚
11. ç”±äºæµè§ˆå™¨å®‰å…¨æ€§çš„è€ƒè™‘ï¼Œå¯¹äºå¤–ç½‘åœ°å€ä½¿ç”¨æ‘„åƒå¤´éœ€è¦åœ¨å®‰å…¨çš„HTTPsåè®®ä¸‹ï¼Œå› æ­¤éœ€è¦ä»˜è´¹æˆ–å…è´¹åœ°å¾—åˆ°è®¤å¯çš„è¯ä¹¦ï¼Œé€šè¿‡ nginx é…ç½®ï¼Œåå‘ä»£ç†è‡³ Node è¿›ç¨‹å³å¯ã€‚

## å…¶ä»–ï¼ˆOtherï¼‰
1. git æ˜¯ç”¨äº Linux å†…æ ¸å¼€å‘çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·ã€‚ä¸ CVSã€Subversion ä¸€ç±»çš„é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶å·¥å…·ä¸åŒï¼Œå®ƒé‡‡ç”¨äº†åˆ†å¸ƒå¼ç‰ˆæœ¬åº“çš„ä½œæ³•ï¼Œä¸éœ€è¦æœåŠ¡å™¨ç«¯è½¯ä»¶ï¼Œå°±å¯ä»¥è¿ä½œç‰ˆæœ¬æ§åˆ¶ï¼Œä½¿å¾—æºä»£ç çš„å‘å¸ƒå’Œäº¤æµæå…¶æ–¹ä¾¿ã€‚ git çš„é€Ÿåº¦å¾ˆå¿«ï¼Œè¿™å¯¹äºè¯¸å¦‚ Linux å†…æ ¸è¿™æ ·çš„å¤§é¡¹ç›®æ¥è¯´è‡ªç„¶å¾ˆé‡è¦ã€‚git æœ€ä¸ºå‡ºè‰²çš„æ˜¯å®ƒçš„åˆå¹¶è¿½è¸ªï¼ˆmerge tracingï¼‰èƒ½åŠ›ã€‚
2. GitHub æ˜¯ä¸€ä¸ªé€šè¿‡ Git è¿›è¡Œç‰ˆæœ¬æ§åˆ¶çš„è½¯ä»¶æºä»£ç æ‰˜ç®¡æœåŠ¡ï¼Œæ˜¯å…¨çƒæœ€å¤§çš„ä»£ç å­˜æ”¾ç½‘ç«™å’Œå¼€æºç¤¾åŒºã€‚
3. ç‰¹å¾è„¸ï¼ˆEigenfaceï¼‰æ˜¯æŒ‡ç”¨äºæœºå™¨è§†è§‰é¢†åŸŸä¸­çš„äººè„¸è¯†åˆ«é—®é¢˜çš„ä¸€ç»„ç‰¹å¾å‘é‡ã€‚è¿™äº›ç‰¹å¾å‘é‡æ˜¯ä»é«˜ç»´çŸ¢é‡ç©ºé—´çš„äººè„¸å›¾åƒçš„åæ–¹å·®çŸ©é˜µè®¡ç®—è€Œæ¥ã€‚ä¸€ç»„ç‰¹å¾è„¸ å¯ä»¥é€šè¿‡åœ¨ä¸€å¤§ç»„æè¿°ä¸åŒäººè„¸çš„å›¾åƒä¸Šè¿›è¡Œä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰è·å¾—ã€‚ä»»æ„ä¸€å¼ äººè„¸å›¾åƒéƒ½å¯ä»¥è¢«è®¤ä¸ºæ˜¯è¿™äº›æ ‡å‡†è„¸çš„ç»„åˆã€‚å¦å¤–ï¼Œç”±äºäººè„¸æ˜¯é€šè¿‡ä¸€ç³»åˆ—å‘é‡ï¼ˆæ¯ä¸ªç‰¹å¾è„¸ä¸€ä¸ªæ¯”ä¾‹å€¼ï¼‰è€Œä¸æ˜¯æ•°å­—å›¾åƒè¿›è¡Œä¿å­˜ï¼Œå¯ä»¥èŠ‚çœå¾ˆå¤šå­˜å‚¨ç©ºé—´ã€‚
4. ä¸»æˆåˆ†åˆ†æï¼ˆPrincipal components analysisï¼ŒPCAï¼‰æ˜¯ä¸€ç§åˆ†æã€ç®€åŒ–æ•°æ®é›†çš„æŠ€æœ¯ã€‚ä¸»æˆåˆ†åˆ†æç»å¸¸ç”¨äºå‡å°‘æ•°æ®é›†çš„ç»´æ•°ï¼ŒåŒæ—¶ä¿æŒæ•°æ®é›†ä¸­çš„å¯¹æ–¹å·®è´¡çŒ®æœ€å¤§çš„ç‰¹å¾ã€‚è¿™æ˜¯é€šè¿‡ä¿ç•™ä½é˜¶ä¸»æˆåˆ†ï¼Œå¿½ç•¥é«˜é˜¶ä¸»æˆåˆ†åšåˆ°çš„ã€‚è¿™æ ·ä½é˜¶æˆåˆ†å¾€å¾€èƒ½å¤Ÿä¿ç•™ä½æ•°æ®çš„æœ€é‡è¦æ–¹é¢ã€‚
5. OpenCVçš„å…¨ç§°æ˜¯Open Source Computer Vision Libraryï¼Œæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„è®¡ç®—æœºè§†è§‰åº“ã€‚OpenCVç”¨C++è¯­è¨€ç¼–å†™ï¼Œå®ƒçš„ä¸»è¦æ¥å£ä¹Ÿæ˜¯C++è¯­è¨€ã€‚


# æ¶‰åŠçŸ¥è¯†ï¼ˆKnowledage Involvedï¼‰

1. javascript / react / redux / react-router / webpack / less / node / babel / es6 / tracking.js / isomorphic / promise
2. http / https / express / mysql
3. opencv / Eigenfaces FaceRecognizer / node addons é™ç»´ã€ç‰¹å¾æå–ã€ç‰¹å¾æ¯”å¯¹
4. homebrew / curl / bash script / electron / cross-env / npm script / screen command / pm2 / nginx / git / seo
5. æœç´¢å¼•æ“ä¼˜åŒ–ï¼ˆsearch engine optimizationï¼ŒSEOï¼‰ï¼Œæ˜¯ä¸€ç§é€šè¿‡äº†è§£æœç´¢å¼•æ“çš„è¿ä½œè§„åˆ™æ¥è°ƒæ•´ç½‘ç«™ï¼Œä»¥åŠæé«˜ç›®çš„ç½‘ç«™åœ¨æœ‰å…³æœç´¢å¼•æ“å†…æ’åçš„æ–¹å¼ã€‚æ‰€è°“â€œé’ˆå¯¹æœç´¢å¼•æ“ä½œæœ€ä¼˜åŒ–çš„å¤„ç†â€ï¼Œæ˜¯æŒ‡ä¸ºäº†è¦è®©ç½‘ç«™æ›´å®¹æ˜“è¢«æœç´¢å¼•æ“æ¥å—ã€‚

ä¸ä»…ä»…å±€é™ä¸ä»¥ä¸Šã€‚ä»¥ä¸Šå·¥å…·ã€ç†è®ºã€æŠ€æœ¯å¯èƒ½åªæ˜¯é¡¹ç›®ç®€å•åœ°ä½¿ç”¨ï¼Œæˆ–æ˜¯å­¦ä¹ è¿‡ç¨‹ä¸­è§¦ç¢°è¿‡è€Œå·²ã€‚

# å­¦ä¹ è®°å½•ï¼ˆLearning Recordï¼‰

## 2016å¹´12æœˆ9æ—¥
1. åˆæ­¥ç¡®å®šè¯¾é¢˜ï¼šåŸºäºå—å¸ˆå¤§æœ¬ç§‘ç”Ÿå­¦ç”Ÿç…§ç‰‡ï¼Œè¿›è¡Œäººè„¸è¯†åˆ«+ç‰¹å¾æå–+äººè„¸ç›¸ä¼¼åº¦å¯¹æ¯”ï¼Œåˆ¤æ–­è¾“å…¥äººç‰©å›¾ç‰‡æ˜¯å¦å­˜åœ¨äºåº“ä¸­ã€‚è‹¥æ—¶é—´å…è®¸ï¼Œç²¾åŠ›æœ‰ä½™ï¼Œè€ƒè™‘åŠ ä¸Šå£°éŸ³æ¯”å¯¹ï¼Œæé«˜è¯†åˆ«æ­£ç¡®ç‡ã€‚
2. æˆåŠŸä¸‹è½½å—å¸ˆå¤§æœ¬ç§‘ç”Ÿç…§ç‰‡ï¼Œä»£ç è§`gp-image-download`æ–‡ä»¶å¤¹ï¼Œä½¿ç”¨bashè„šæœ¬+nodeå®ç°ï¼Œå¯ä»¥æ–¹ä¾¿çš„è·¨å¹³å°ã€‚

## 2016å¹´12æœˆ10æ—¥
åˆæ­¥äº†è§£äººè„¸è¯†åˆ«æ£€æµ‹ã€‚
äº§ç”Ÿæ€€ç–‘ï¼š
1. çº¯ç²¹è‡ªå·±å®ç°ç³»åˆ—è¯†åˆ«ï¼Œç‰¹å¾æå–ï¼Œæ¨¡å¼åŒ¹é…ç­‰ç­‰ã€‚ä»…æ˜¯è¯†åˆ«ç®—æ³•ç†è®ºï¼Œéœ€è¦çš„æ•°å­¦åŠŸåº•è¾ƒå¤æ‚...æ•°å­¦å·²ç»ä¸¢çš„å·®ä¸å¤šäº†..è¿›åº¦ç¼“æ…¢ï¼Œæ— æ³•å…¥æ‰‹ï¼Œææ€•è¾ƒéš¾å®Œæˆã€‚
2. è°ƒç”¨opencvæ¥å£æˆ–è€…è°ƒç”¨ç½‘ä¸Šapiï¼Œææ€•å·¥ä½œé‡ä¸å¤Ÿ(åº”ç”¨äº¤äº’è®¾è®¡å®Œå¤‡ç‚¹ï¼Ÿ)
3. æ¢ä¸ªè¯¾é¢˜ï¼Ÿå¤‡é€‰moka(1)æˆ–è€…iNjnu App(2)

## 2016å¹´12æœˆ11æ—¥
1. æ­å»ºå­¦ç”Ÿç­¾åˆ°ç³»ç»Ÿå¼€å‘ç¯å¢ƒï¼Œé‡‡ç”¨`react + redux + react-router + webpack`æŠ€æœ¯æ ˆï¼Œåˆ©ç”¨webå‰ç«¯æŠ€æœ¯å®ç°ç•Œé¢ï¼Œåç»­å¯ä»¥ä½¿ç”¨`electron`æ‰“åŒ…ä¸ºè·¨å¹³å°app
2. æ³¨å†Œ`face++`è´¦å·ï¼Œæ‰“ç®—é‡‡ç”¨ç¬¬ä¸‰æ–¹äººè„¸è¯†åˆ«æ¯”å¯¹api
	
## 2016å¹´12æœˆ12æ—¥
1. åˆæ­¥å¼€å‘å‰ç«¯é¡µé¢+åç«¯æœåŠ¡(node express), å‰åç«¯åˆ†ç¦»
2. ä½¿ç”¨`Sublime`ç¼–è¾‘å™¨ï¼Œé»˜è®¤ç¼©è¿›ä¸º`Tab`ï¼Œä¹¦å†™è„šæœ¬`updateIndent.js`ï¼Œæ‰¹é‡ä¿®æ”¹`Tab`ä¸ºå››ç©ºæ ¼

3. è¯¾é¢˜ç¡®å®šï¼Œã€Šå—å¸ˆå¤§å­¦ç”Ÿåˆ·è„¸ç­¾åˆ°ç³»ç»Ÿã€‹
å¯¹äºäººè„¸è¯†åˆ«+æ¯”å¯¹æ–¹é¢å®ç°ï¼Œåˆæ­¥è€ƒè™‘3ä¸ªè§£å†³æ–¹æ¡ˆï¼š
1. äººè„¸è¯†åˆ«+æ¯”å¯¹ç®—æ³•å®Œå…¨è‡ªå·±å®ç°ã€‚
2. è°ƒç”¨opencväººè„¸è¯†åˆ«api + è‡ªå·±å®ç°äººè„¸æ¯”å¯¹ç®—æ³•ã€‚
3. è°ƒç”¨ç½‘ä¸Šè¾ƒæˆç†Ÿçš„äººè„¸è¯†åˆ«+äººè„¸æ¯”å¯¹æ¥å£ï¼Œå¦‚Face++ã€‚
ä»¥ä¸Šä¸‰ç§è§£å†³æ–¹æ¡ˆå·¥ä½œé‡é€’å‡ï¼ˆæˆ–è€…å·¥ä½œé‡å¯ä»¥åœ¨ç³»ç»ŸåŠŸèƒ½å®Œå¤‡æ€§æ–¹é¢ä½“ç°ï¼‰ï¼Œä½†æ˜¯è¯†åˆ«æ¯”å¯¹å‡†ç¡®ç‡é€’å¢ã€‚

ä¸çŸ¥é“è€å¸ˆå¯¹ä»¥ä¸Šä¸‰ç§æ–¹æ¡ˆæœ‰ä»€ä¹ˆçœ‹æ³•ã€‚
å¦‚æœé‡‡ç”¨1æˆ–2ï¼Œæœ¬äººä¸çŸ¥é“åº”è¯¥çœ‹ä»€ä¹ˆç›¸å…³ä¹¦ç±å…¥é—¨(æ•°å­¦å·²ç»ä¸¢çš„å·®ä¸å¤šäº†ï¼Œéè€ƒç ”å…š)ï¼Œä»¥åŠæ‰€ç”¨æ—¶é—´å’Œæœ€ç»ˆæ•ˆæœéƒ½å¯èƒ½ä¸å°½äººæ„ã€‚

è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šé¢å‘å­¦ç”Ÿçš„æ•™åŠ¡ç³»ç»Ÿå¥½åƒæ²¡æœ‰è¾“å…¥è¯¾ç¨‹å·ï¼Œæ•™å¸ˆIDï¼Œè¾“å‡ºå…¨éƒ¨é€‰è¯¾å­¦ç”ŸIDçš„æ¥å£ã€‚æˆ–è€…åœ¨é¢å‘æ•™å¸ˆçš„æ•™åŠ¡ç³»ç»Ÿæ‰æœ‰æä¾›ï¼Œä½†æˆ‘æ²¡æœ‰æ•™å¸ˆè´¦å·å¯†ç ï¼Œä¸èƒ½è‡ªå·±çˆ¬å–ã€‚ä¸çŸ¥é“æˆ‘åº”è¯¥è”ç³»è°ï¼Œæ‰å¯ä»¥æä¾›è¯¥æ¥å£ã€‚

4. [è·å–å­¦å·æ¥å£](http://urp.njnu.edu.cn/authorizeUsers.portal?start=0&limit=100&term=191301)
5. æ ¹æ®çˆ¬å–çš„å­¦ç”Ÿç…§ç‰‡ï¼Œåˆ›å»ºæ•°æ®åº“stu(id, audio), sign(id, time, stu_id); ç­çº§çš„åˆ¤æ–­ï¼Œé€šè¿‡å·²ç»å¾—åˆ°ids.txtå‰6ä½å¾—åˆ°ï¼ˆå»æ‰éçº¯æ•°å­—çš„ï¼Œä½æ•°ä¸åŒçš„ï¼‰
6. æ„æ€ç®¡ç†å‘˜å…¥å£ => ç™»å½•(åˆ¤æ–­æ˜¯å¦å·²ç»ç™»å½•) => æŸ¥çœ‹å­¦ç”Ÿä¿¡æ¯(æ ¹æ®å­¦å·ï¼Œå§“åï¼Œç­çº§å·) + ç­¾åˆ°ä¿¡æ¯æŸ¥çœ‹ 

## 2016å¹´12æœˆ13æ—¥
1. é‡æ‹¾æ•°å­¦
	[ç§¯åˆ†](https://zh.wikipedia.org/wiki/%E7%A7%AF%E5%88%86) [æ–¹å·®](https://zh.wikipedia.org/wiki/%E6%96%B9%E5%B7%AE) [åæ–¹å·®](https://zh.wikipedia.org/wiki/%E5%8D%8F%E6%96%B9%E5%B7%AE)
	[ç»Ÿè®¡ç‹¬ç«‹] çŸ©é˜µ [åæ–¹å·®çŸ©é˜µ*(å†™å¾—å¥½)](http://blog.csdn.net/itplus/article/details/11452743)
2. æ–¹å·®æè¿°çš„æ˜¯å®ƒçš„ç¦»æ•£ç¨‹åº¦ï¼Œä¹Ÿå°±æ˜¯è¯¥å˜é‡ç¦»å…¶æœŸæœ›å€¼çš„è·ç¦»ã€‚
3. åæ–¹å·®è¡¨ç¤ºçš„æ˜¯ä¸¤ä¸ªå˜é‡çš„æ€»ä½“çš„è¯¯å·®ï¼Œè¿™ä¸åªè¡¨ç¤ºä¸€ä¸ªå˜é‡è¯¯å·®çš„æ–¹å·®ä¸åŒã€‚ å¦‚æœä¸¤ä¸ªå˜é‡çš„å˜åŒ–è¶‹åŠ¿ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå…¶ä¸­ä¸€ä¸ªå¤§äºè‡ªèº«çš„æœŸæœ›å€¼ï¼Œå¦å¤–ä¸€ä¸ªä¹Ÿå¤§äºè‡ªèº«çš„æœŸæœ›å€¼ï¼Œé‚£ä¹ˆä¸¤ä¸ªå˜é‡ä¹‹é—´çš„åæ–¹å·®å°±æ˜¯æ­£å€¼ã€‚ å¦‚æœä¸¤ä¸ªå˜é‡çš„å˜åŒ–è¶‹åŠ¿ç›¸åï¼Œå³å…¶ä¸­ä¸€ä¸ªå¤§äºè‡ªèº«çš„æœŸæœ›å€¼ï¼Œå¦å¤–ä¸€ä¸ªå´å°äºè‡ªèº«çš„æœŸæœ›å€¼ï¼Œé‚£ä¹ˆä¸¤ä¸ªå˜é‡ä¹‹é—´çš„åæ–¹å·®å°±æ˜¯è´Ÿå€¼ã€‚
4. [face_camera](https://trackingjs.com/bower/tracking.js/examples/face_camera.html) ï¼ˆJsäººè„¸æ£€æµ‹æ’ä»¶ï¼Œå»æ‰æ‰‹åŠ¨æ‹ç…§ï¼Œç›‘æ§æ‘„åƒå¤´è¯†åˆ«äººè„¸ï¼Œå¯ä»¥æ ¹æ®searchingå’Œæ˜¯å¦æœ‰äººè„¸è¿›è¡Œå¯¹æ¯”æ“ä½œï¼Œåªå‘é€å¤šä¸ªäººè„¸éƒ¨åˆ†å›¾åƒï¼‰**çœ‹ä¸‹æºç ï¼Œå­¦ä¹ è¯†åˆ«ç®—æ³•**

## 2016å¹´12æœˆ14æ—¥
1. opencv install:  

		brew tap homebrew/science
		brew install opencv

	[install-opencv-3-on-yosemite-osx-10-10-x](https://www.learnopencv.com/install-opencv-3-on-yosemite-osx-10-10-x/)
	[linux_install](http://docs.opencv.org/2.4/doc/tutorials/introduction/linux_install/linux_install.html)
	[install-opencv-3-0-and-python-2-7-on-osx](http://www.pyimagesearch.com/2015/06/15/install-opencv-3-0-and-python-2-7-on-osx/)
2. [æ·»åŠ opencvä¾èµ–](http://docs.opencv.org/2.4/doc/tutorials/introduction/linux_gcc_cmake/linux_gcc_cmake.html)
3. brewæ›´æ”¹æº
	æ›¿æ¢formula ç´¢å¼•çš„é•œåƒï¼ˆå³ brew update æ—¶æ‰€æ›´æ–°å†…å®¹ï¼‰
	```
	cd "$(brew --repo)"
	git remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git

	cd "$(brew --repo)/Library/Taps/homebrew/homebrew-core"
	git remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git

	brew update
	```
	æ›¿æ¢Homebrew äºŒè¿›åˆ¶é¢„ç¼–è¯‘åŒ…çš„é•œåƒ
	```
	echo 'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles' >> ~/.bash_profile
	source ~/.bash_profile
	```
4. [node-opencv](https://github.com/peterbraden/node-opencv)  
	[Issue](https://github.com/peterbraden/node-opencv/issues/380#issuecomment-191492421)

## 2016å¹´12æœˆ16æ—¥
1. ä½¿ç”¨node-opencvæ£€æµ‹äººè„¸ï¼ŒæŒ‘é€‰å‡ºæ•ˆæœç›¸å¯¹å¥½çš„åˆ†ç±»æ¨¡æ¿`lbpcascade_frontalface.xml`, å¯¹æ¯”æ•ˆæœæ•°æ®è§`backend/data/summary.json`
2. æ­»åš¼PCAç†è®º[1](http://blog.csdn.net/itplus/article/details/11451327), [2](http://blog.csdn.net/liulina603/article/details/7912950)

## 2016å¹´12æœˆ18æ—¥
1. [äººè„¸æ£€æµ‹æ¨¡å¼åŒ¹é…æ•°æ®xml2json](http://www.freeformatter.com/xml-to-json-converter.html)(éœ€VPN)
2. å‘ç°äººè„¸è¯†åˆ«æ•ˆæœä¸ä½³ï¼Œåˆ†æåŸå› ï¼Œ ç¬¬ä¸€ï¼Œæ ·æœ¬æ¯ä¸ªäººåªæœ‰ä¸€å¼  ï¼Œç¬¬äºŒï¼Œå‡ å¹´ä¸‹æ¥ï¼Œäººçš„å˜åŒ–æ¯”è¾ƒå¤§ã€‚
3. æ–°å¢æ ·æœ¬è¾“å…¥æ¨¡å—ï¼Œå­¦ç”Ÿè‡ªä¸»è¾“å…¥åˆ é™¤æ ·æœ¬ã€‚ï¼ˆéœ€è¦é‡æ–°è®­ç»ƒï¼Œå­˜å‚¨ï¼‰
4. é‡‡ç”¨opencv Eigenfaces äººè„¸è¯†åˆ«ç®—æ³•

## 2017å¹´1æœˆ11æ—¥
`image-download`å»é™¤å¯¹`wget`ä¾èµ–ï¼Œæ”¹ç”¨`curl`æŒ‡ä»¤ä¸‹è½½

## 2017å¹´1æœˆ16æ—¥
1. `/usr/local/bin/mysql.server start` å¯åŠ¨mysql
2. å¼€å§‹`mysql`æ•°æ®åº“è®¾è®¡: `face_import table`, ä¹¦å†™DAOä»£ç 
3. ç®€åŒ–éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘ï¼Œåˆ é™¤éå¿…é¡»è¾“å…¥æƒ…å†µ(æœ¬åœ°å›¾ç‰‡ï¼Œç½‘ç»œå›¾ç‰‡)
4. è€ƒè™‘åˆ°æ•°æ®çš„è¿ç§»ç®€ä¾¿å’ŒæœåŠ¡å™¨è´Ÿè½½ï¼Œä½¿ç”¨`sm.ms`å…è´¹å›¾åºŠï¼Œå­˜å‚¨ç”¨æˆ·å¯¼å…¥çš„äººè„¸å›¾ç‰‡
5. å®Œæˆ100%äººè„¸å½•å…¥é€»è¾‘ã€‚TODO: æ¯æ¬¡å¯åŠ¨æœåŠ¡å™¨éœ€è¦è¯»å–æ•°æ®åº“ï¼Œå¾—åˆ°smmså›¾ç‰‡æ•°æ®ï¼Œè¿›è¡Œè®­ç»ƒã€‚ï¼ˆä¸ºäº†ä¿è¯Devç¯å¢ƒå¯åŠ¨é€Ÿåº¦ï¼Œæš‚æ—¶ä¸åšï¼‰
6. å¼•å…¥`cross-env`ï¼šè·¨å¹³å°è®¾ç½®ç¯å¢ƒå˜é‡NPMåŒ…, åŒºåˆ†Dev(çˆ¶è¿›ç¨‹ç›‘å¬jsæ–‡ä»¶æ”¹åŠ¨ï¼Œæ”¹åŠ¨ååˆ™é‡å¯æœåŠ¡å™¨)ä¸Productionç¯å¢ƒ
	
## 2017å¹´1æœˆ17æ—¥
1. æ”¹å–„è®­ç»ƒæ ·æœ¬æ–¹æ³•ï¼ŒåŠ ä¸Šäº†smmså¤–é“¾çš„å›¾ç‰‡è®­ç»ƒ(ä¸€å¤§ä¸²Promise)
2. å®Œæˆå‰åç«¯åˆ†ç¦»çš„ç®¡ç†å‘˜ç™»å½•çŠ¶æ€æ§åˆ¶(æœ¬åœ°å­˜å‚¨+md5ç¼–ç )ï¼Œå®Œæˆç®¡ç†å‘˜æ ·æœ¬æŸ¥çœ‹åŠŸèƒ½ã€‚
	
## 2017å¹´1æœˆ18æ—¥
1. å®Œæˆæ¯æ¬¡å¯åŠ¨æœåŠ¡å™¨éœ€è¦è¯»å–æ•°æ®åº“ï¼Œå¾—åˆ°smmså›¾ç‰‡æ•°æ®ï¼Œè¿›è¡Œè®­ç»ƒã€‚
2. å®Œæˆåˆ é™¤/æ·»åŠ äººè„¸æ ·æœ¬ï¼Œé‡æ–°è®­ç»ƒé€»è¾‘(å¼‚æ­¥ï¼Œä¸ä¿è¯å®æ—¶æ€§)ã€‚
3. å¯¹äºå­¦ç”Ÿè¯ç…§ï¼Œ`lbpcascade_frontalface, scale=1.95å·¦å³`äººè„¸æ£€æµ‹æ•ˆæœè¾ƒå¥½
4. [distance convert to precentage](http://stackoverflow.com/questions/13652778/what-is-confidence-in-opencvs-facerecognizer)
5. confidence<?, è®¤ä¸ºæ˜¯æ­£ç¡®
6. æ•´ä½“å¤§è‡´å·²ç»å®Œæˆï¼Œé˜ˆå€¼çš„ç¡®å®šå°šæœªå®Œæˆ
7. [iterm2, å¿«æ·é”®è®¾ç½®(useful!)](https://coderwall.com/p/h6yfda/use-and-to-jump-forwards-backwards-words-in-iterm-2-on-os-x)

## 2017å¹´1æœˆ19æ—¥
1. Serverè¯»å–appä»£ç æ—¶ï¼Œnode_moduleå›ç¯åŠ è½½ï¼Œå‡ºç°é”™è¯¯ï¼Œä¿®æ”¹æˆåªä½¿ç”¨æœ€å¤–å±‚node_modules
2. react Serverç«¯æ¸²æŸ“ï¼Œrequire() æ ·å¼æ–‡ä»¶çš„è§£å†³æ–¹æ³•ï¼Ÿ(ignore, onlyæ— æ•ˆ)
3. HTTPsæ‰èƒ½ä½¿ç”¨æ‘„åƒå¤´ï¼Œå› æ­¤æäº†ä¸ªå…è´¹è¯ä¹¦ï¼Œé…ç½®ä¸‹nginx
	- [https://aotu.io/notes/2016/08/16/nginx-https/](å€¼å¾—ç»†åš¼)
	- [https://www.zhihu.com/question/19578422](å…è´¹è¯ä¹¦)
	- http://serverfault.com/questions/67316/in-nginx-how-can-i-rewrite-all-http-requests-to-https-while-maintaining-sub-dom
4. macè¿ç§»åˆ°ubuntuä¸€ç³»åˆ—çš„é—®é¢˜
	1. http://stackoverflow.com/questions/12335848/opencv-program-compile-error-libopencv-core-so-2-4-cannot-open-shared-object-f
	2. unixå¹³å°çš„å¿«é€Ÿå®‰è£…è„šæœ¬=> `start.sh`
5. [nativefier](https://github.com/jiahaog/nativefier) => ç«™ç‚¹æ‰“åŒ…æˆAppè§£å†³æ–¹æ¡ˆ, `ELECTRON_MIRROR=https://npm.taobao.org/mirrors/electron/`
6. app:packager scripts
```
"app:mac64": "set ELECTRON_MIRROR=https://npm.taobao.org/mirrors/electron/ && nativefier -a x64 -p mac --name \"å—å¸ˆå¤§åˆ·è„¸ç­¾åˆ°\" \"https://face.moyuyc.xyz/\" -i logos/logo.icns --disable-dev-tools --disable-context-menu",
"app:mac32": "set ELECTRON_MIRROR=https://npm.taobao.org/mirrors/electron/ && nativefier -a ia32 -p mac --name \"å—å¸ˆå¤§åˆ·è„¸ç­¾åˆ°\" \"https://face.moyuyc.xyz/\" -i logos/logo.icns --disable-dev-tools --disable-context-menu",
"app:win32": "set ELECTRON_MIRROR=https://npm.taobao.org/mirrors/electron/ && nativefier -p win32 -a x64 --name \"å—å¸ˆå¤§åˆ·è„¸ç­¾åˆ°\" \"https://face.moyuyc.xyz/\" -i logos/logo.png --disable-dev-tools --disable-context-menu",
"app:win64": "set ELECTRON_MIRROR=https://npm.taobao.org/mirrors/electron/ && nativefier -p win32 -a ia32 --name \"å—å¸ˆå¤§åˆ·è„¸ç­¾åˆ°\" \"https://face.moyuyc.xyz/\" -i logos/logo.png --disable-dev-tools --disable-context-menu"
```

## 2017å¹´1æœˆ20æ—¥
1. åŒæ„æ¸²æŸ“(ä¼˜åŒ–seo+é¦–å±æ¸²æŸ“) [css moduleæ‰“åŒ…çš„è§£å†³æ–¹æ¡ˆ](http://www.aliued.com/?p=3077), [webpack-isomorphic-tools](https://github.com/halt-hammerzeit/webpack-isomorphic-tools)
2. [è¿œç«¯å‘å¸ƒ screenæŒ‡ä»¤](https://github.com/chenzhiwei/linux/tree/master/screen)

## 2017å¹´1æœˆ21æ—¥
1. google+baidu æ”¶å½•ï¼Œæ·»åŠ  robots.txt ä¸ sitemap.txtï¼Œå¦‚ä»Šåœ¨googleä¸‹æœç´¢ `å—äº¬å¸ˆèŒƒå¤§å­¦ åˆ·è„¸` å³å¯

# ç³»ç»Ÿå‰–æï¼ˆSystem Analysisï¼‰

æºç åœ°å€ï¼š[Graduation-Project](https://github.com/moyuyc/graduation-project)

## æ–‡ä»¶ç»“æ„ï¼ˆDirectory Treeï¼‰

é¡¶å±‚æ–‡ä»¶ç»“æ„å¦‚ä¸‹
```
Graduation-Project/
â”œâ”€â”€ desktop/
â”œâ”€â”€ gp-image-download/
â”œâ”€â”€ gp-njnu-photos-app/
â””â”€â”€ gp-njnu-photos-backend/
```

`desktop/` ä¸­æ”¾çš„æ˜¯å°†ç«™ç‚¹æ‰“åŒ…æˆ PC Desktop çš„ Logoï¼Œ`logo.icns` ç”¨åœ¨ osx ç³»ç»Ÿä¸­ï¼Œ`logo.png` åˆ™ç”¨äº linux ä¸ windows ç³»ç»Ÿä¸­ï¼Œæ‰“åŒ…æˆçš„ PC Desktop é»˜è®¤ä¹Ÿæ˜¯æ”¾åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹ã€‚
```
desktop/
â””â”€â”€ logos/
    â”œâ”€â”€ logo.icns
    â”œâ”€â”€ logo.ico
    â””â”€â”€ logo.png 
```

`gp-image-download/` æ–‡ä»¶å¤¹é‡Œé¢æ”¾çš„æ˜¯å°†æ•™åŠ¡ç³»ç»Ÿçš„å­¦ç”Ÿå›¾ç‰‡ä¸‹è½½è‡³è¯¥æ–‡ä»¶å¤¹ä¸­ï¼Œå…¶ä¸­çš„ `data/` æ–‡ä»¶å¤¹æ”¾çš„æ˜¯å„å¹´å…¥å­¦çš„å­¦ç”Ÿçš„å­¦å·ï¼ˆéƒ¨åˆ†å­¦å·ä¸æ­£ç¡®ï¼‰ï¼Œæ•°æ®æ˜¯ `get-all-id.js` è„šæœ¬å¾—åˆ°ï¼Œå…·ä½“å·¥ä½œç»†èŠ‚åœ¨åé¢ä¼šè¯´åˆ°ã€‚ä¿è¯è·å–åˆ°å„å¹´çš„å­¦ç”Ÿå­¦å·é›†åï¼Œé€šè¿‡ `download.sh` Bash è„šæœ¬å³å¯è¿›è¡Œä¸‹è½½ï¼›ä¸‹è½½çš„å›¾ç‰‡æ”¾åœ¨ `images/` ä¸­ã€‚
```
gp-image-download/
â”œâ”€â”€ data/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ download.sh
â”œâ”€â”€ get-all-id.js
â”œâ”€â”€ images/
â”‚   â””â”€â”€ ...
â””â”€â”€ lib/
    â””â”€â”€ get-all-id.js
```

`gp-njnu-photos-app/` æ”¾çš„æ˜¯å‰ç«¯ä»£ç ï¼Œ`app/` æ˜¯å¼€å‘ç”¨çš„æºç ï¼Œ`build/` æ˜¯ç”¨ Webpack æ‰“åŒ…çš„å‹ç¼©åçš„å‘å¸ƒèµ„æºï¼ŒåŒ…æ‹¬ `css/js/html/image...`
```
gp-njnu-photos-app/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ build/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ index.js
â”œâ”€â”€ package.json
â”œâ”€â”€ webpack-assets.json
â””â”€â”€ webpack.config.js
```

`gp-njnu-photos-backend/` æ”¾çš„æ˜¯åç«¯çš„å…¨éƒ¨ä»£ç ã€‚  
- `cpptest/` c++ opencv çš„ä¸€äº›æµ‹è¯•  
- `test/` nodejs è°ƒç”¨ opencv æ¥å£çš„ä¾‹å­  
- `data/` æ”¾äº›äººè„¸ xml æ¨¡æ¿æ•°æ®ï¼ŒæœåŠ¡å™¨è¿è¡Œæ—¶ç”Ÿæˆçš„ç¼“å­˜æ•°æ®ï¼Œé¢„å¤„ç†åçš„å­¦ç”Ÿç…§ç‰‡ï¼Œä¸Šä¸€æ¬¡ä¿å­˜çš„è®­ç»ƒæ•°æ®ã€‚  
- `database/` è®¿é—® mysql çš„ JS æ¥å£
- `lib/` ä¸€äº›é€šç”¨çš„ JS æ–¹æ³•ï¼Œæ¯”å¦‚çˆ¬è™«æ¥å£ï¼Œå›¾ç‰‡ä¸Šä¼ æ¥å£...  
- `opencv/` æ­å»º nodejs ä¸ C++ æ¡¥æ¢çš„æºç ä¸äº§ç”Ÿçš„é“¾æ¥åº“
- `pretreat` ä¸€äº›é¢„å¤„ç†æ¥å£ï¼Œå¦‚äººè„¸æ£€æµ‹ï¼Œå›¾ç‰‡ç°åŒ–å¤„ç†ï¼Œæ ·æœ¬æ•°æ®çš„è®­ç»ƒ...
- `routes` express çš„è·¯ç”±æ§åˆ¶æ–‡ä»¶
- `ssl` HTTPs è¯ä¹¦ä¸å¯†é’¥
- `server.js` HTTP æœåŠ¡å…¥å£
- `index.js` åœ¨è°ƒç”¨ `server.js` ä¹‹å‰ï¼Œè·å–å‰ç«¯æ•°æ®ï¼Œä½¿å¾—åç«¯èƒ½å¤Ÿå¤„ç†é™æ€èµ„æºï¼ˆimage/css/...ï¼‰ï¼Œä¸ºå‰åç«¯å…¬ç”¨ä¸€å¥—ä»£ç æä¾›è§£å†³æ–¹æ¡ˆã€‚ï¼ˆä¸€èˆ¬åœ¨çº¿ä¸Šç¯å¢ƒä½¿ç”¨ï¼‰
- `provider.js` åˆ›å»ºå­è¿›ç¨‹ `server.js`ï¼ŒåŒæ—¶ç›‘å¬åç«¯å¼€å‘ç›®å½•ä»£ç çš„æ”¹åŠ¨ï¼Œä¸€æ—¦æ”¹åŠ¨ä¾¿æ€æ­»ä¸Šä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä¸”å†æ¬¡åˆ›å»ºå­è¿›ç¨‹ `server.js`ï¼Œå¯ä»¥å®ç°åç«¯ä»£ç çš„***çƒ­æ›´æ–°***ã€‚ï¼ˆä¸€èˆ¬åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨ï¼‰

```
gp-njnu-photos-backend/
â”œâ”€â”€ cpptest/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ test/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ data/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ database/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ opencv/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ pretreat/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ssl/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ index.js
â”œâ”€â”€ package.json
â”œâ”€â”€ provider.js
â””â”€â”€ server.js
```

## è¿‡ç¨‹ï¼ˆLearning Processï¼‰

### å­¦ç”Ÿç…§ç‰‡ä¸‹è½½
ä¸‹è½½è¯ä»¶ç…§å°±éœ€è¦å›¾ç‰‡çš„ URLï¼Œåœ¨[åˆ©ç”¨Pythonçˆ¬å–å­¦æ ¡ç½‘ç«™ä¸Šçš„è¯ä»¶ç…§](http://blog.chaiziyi.com.cn/2016/06/03/%E5%88%A9%E7%94%A8Python%E7%88%AC%E5%8F%96%E5%AD%A6%E6%A0%A1%E7%BD%91%E7%AB%99%E4%B8%8A%E7%9A%84%E8%AF%81%E4%BB%B6%E7%85%A7%EF%BC%88%E5%9B%9B%EF%BC%89/)ä¸€æ–‡ä¸­ï¼Œè¯´åˆ°äº†æ•™åŠ¡å¤„çš„å­¦ç”Ÿè¯ URL è§„åˆ™æ˜¯ `http://${hostname}/jwgl/photos/rx${year}/${studentno}.jpg` ï¼Œ`hostname`å°±æ˜¯æ•™åŠ¡ç³»ç»Ÿçš„ä¸»æœºåœ°å€ï¼Œ`year`å°±æ˜¯å…¥å¹´ä»½ï¼Œ`studentno`æ˜¯å­¦ç”Ÿå­¦å·ï¼Œæ¯”å¦‚æŸå­¦ç”Ÿå­¦å·æ˜¯`19140429`ï¼Œå…¶ä¸­å­¦å·çš„3-4ä½è¡¨ç¤ºå…¥å­¦å¹´ä»½ï¼Œè¡¨ç¤ºå­¦ç”Ÿæ˜¯ 2014 å¹´å…¥å­¦ï¼Œé‚£ä¹ˆä»–çš„å­¦ç”Ÿè¯ URL å°±æ˜¯ `http://223.2.10.123/jwgl/photos/rx2014/19140429`ï¼›  

çŸ¥é“äº†å­¦ç”Ÿç…§çš„ URL è§„åˆ™åï¼Œé‚£ä¹ˆæ€ä¹ˆå¾—åˆ°å„ä¸ªå­¦å¹´å…¥å­¦çš„å­¦ç”Ÿå­¦å·é›†åˆå‘¢ï¼Ÿ
å¦‚æœç”¨ç©·ä¸¾æ³•ï¼Œå­¦å·ä¸€å…±æœ‰ 8 ä½ï¼Œæ¯ä½æœ‰ 0-9 10 ç§å¯èƒ½ï¼Œé‚£ä¹ˆå¾—åˆ°æ¯ä¸€å¹´çš„å­¦ç”Ÿç…§ç‰‡å°±éœ€è¦ LOOP 10^8 æ¬¡ï¼Œè¿™ç§çº§åˆ«çš„æ—¶é—´å¤æ‚åº¦æ˜¯ä¸å¯æ¥å—çš„ã€‚äºæ˜¯é€šè¿‡æŸ¥é˜…ï¼Œæœç´¢æ‰¾åˆ°äº†
[è·å–å—å¸ˆå¤§å­¦å·](http://blog.chaiziyi.com.cn/2016/06/13/%E5%88%A9%E7%94%A8Python%E8%BF%87%E6%BB%A4%E6%9C%89%E7%94%A8%E6%A0%A1%E5%9B%AD%E7%BD%91%E8%B4%A6%E5%8F%B7/)ï¼Œé‡Œé¢æåˆ°äº†è·å–å­¦å·çš„æ¥å£`http://urp.njnu.edu.cn/authorizeUsers.portal?limit=100&term=191301`ï¼Œ`term` è¡¨ç¤ºæœç´¢å…³é”®å­—ï¼Œå¯ä»¥æ˜¯ `1913/191301/...` å°†ä¼šè¿”å›å­¦å·ä¸­å«æœ‰å…¶å­—ç¬¦ä¸²çš„æ•°æ®ï¼Œlimitåˆ™æ˜¯æ•°æ®æ•°æœ€å¤§é™åˆ¶ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ä¾¿å¯ä»¥å¾—åˆ°å­¦å·é›†åˆ

æœ€åä¾¿æ˜¯å­¦ç”Ÿç…§ç‰‡ä¸‹è½½çš„ä»£ç ä¹¦å†™äº†ã€‚
é‡‡ç”¨çš„æ˜¯ Bash Script ä¹¦å†™ï¼Œå…·æœ‰è¾ƒå¼ºçš„æ˜“ç”¨æ€§ï¼Œä¸éœ€è¦å¤æ‚çš„å¹³å°ã€ç¯å¢ƒä¾èµ–ã€‚ç¬¬ä¸€ç‰ˆæ˜¯ä½¿ç”¨ `wget` æŒ‡ä»¤è¿›è¡Œä¸‹è½½ï¼Œä½†æ˜¯è¯¥æŒ‡ä»¤åœ¨ `windows/osx` éœ€è¦é¢å¤–å®‰è£…ï¼Œæ‰€ä»¥æœ€åæ”¹æˆäº† `curl`ã€‚

![](https://ooo.0o0.ooo/2017/01/22/5884923dd9155.jpg)
![](https://ooo.0o0.ooo/2017/01/22/5884926960c79.jpg)

### äººè„¸è¯†åˆ«ç†è®ºå­¦ä¹ 

äººè„¸è¯†åˆ«å®é™…åŒ…æ‹¬æ„å»ºäººè„¸è¯†åˆ«ç³»ç»Ÿçš„ä¸€ç³»åˆ—ç›¸å…³æŠ€æœ¯ï¼ŒåŒ…æ‹¬äººè„¸å›¾åƒé‡‡é›†ã€äººè„¸å®šä½ã€äººè„¸è¯†åˆ«é¢„å¤„ç†ã€èº«ä»½ç¡®è®¤ä»¥åŠèº«ä»½æŸ¥æ‰¾ç­‰ã€‚ä¸Šä¸€æ­¥å·²ç»å®Œæˆäº†äººè„¸çš„é‡‡é›†ï¼›  äººè„¸å®šä½ä¹Ÿå°±æ˜¯äººè„¸çš„æ£€æµ‹ï¼Œåœ¨ä¸€å¼ å›¾ç‰‡ä¸­ï¼Œæ‰¾å‡ºäººè„¸çš„ä½ç½®ã€‚é€šè¿‡ä¸€äº›ç‰¹å¾æå–çš„æ–¹æ³•ï¼Œå¦‚[HOGç‰¹å¾ï¼ŒLBPç‰¹å¾ï¼ŒHaarç‰¹å¾](http://www.voidcn.com/blog/jscese/article/p-6250381.html)ï¼Œ[è®­ç»ƒ](http://www.opencv.org.cn/opencvdoc/2.3.2/html/doc/user_guide/ug_traincascade.html)å¾—åˆ°çº§è”åˆ†ç±»å™¨ï¼Œåˆ†ç±»å™¨å¯¹å›¾åƒçš„ä»»æ„ä½ç½®å’Œä»»æ„å°ºå¯¸çš„éƒ¨åˆ†(é€šå¸¸æ˜¯æ­£æ–¹å½¢æˆ–é•¿æ–¹å½¢)è¿›è¡Œåˆ†ç±»ï¼Œåˆ¤å®šæ˜¯æˆ–ä¸æ˜¯äººè„¸ã€‚opencvæºç ä¸­æä¾›äº†ä¸€äº›[å¸¸ç”¨çš„åˆ†ç±»å™¨](https://github.com/opencv/opencv/tree/master/data)ï¼ˆXMLï¼‰ã€‚äººè„¸è¯†åˆ«é¢„å¤„ç†ä¹Ÿå°±æ˜¯å¯¹å›¾åƒè¿›è¡Œç°åŒ–ï¼Œäººè„¸æ£€æµ‹ï¼Œå¾—åˆ°ç»Ÿä¸€å¤§å°çš„äººè„¸å›¾ç‰‡ï¼›ç„¶åä¾¿æ˜¯è¯†åˆ«äº†ï¼Œå¯¹æ ·æœ¬è®­ç»ƒ[ç”Ÿæˆç‰¹å¾è„¸](https://zh.wikipedia.org/wiki/%E7%89%B9%E5%BE%81%E8%84%B8#.E7.94.9F.E6.88.90.E7.89.B9.E5.BE.81.E8.84.B8)åï¼Œå¯¹äºè¾“å…¥çš„äººè„¸è¿›è¡Œé¢„å¤„ç†åï¼Œå¾—åˆ°å…¶[ç‰¹å¾è„¸æƒé‡å‘é‡](http://blog.csdn.net/smartempire/article/details/21406005)ï¼Œè®¡ç®—å‘é‡è·ç¦»ï¼Œæ‰¾åˆ°æœ€å°è·ç¦»çš„æ ·æœ¬äººè„¸ã€‚

å¯ä»¥çœ‹åˆ°ç‰¹å¾è„¸çš„ç”Ÿæˆæ˜¯éœ€è¦æ•´ä¸ªæ ·æœ¬æ•°æ®çš„ï¼Œæ‰€ä»¥å¦‚æœç”¨æˆ·ä¿®æ”¹äº†æ ·æœ¬æ•°æ®ï¼Œéœ€è¦å¯¹å…¨éƒ¨æ ·æœ¬é‡æ–°è®­ç»ƒï¼Œå¾—åˆ°ä¸€ç»„å…¨æ–°çš„ç‰¹å¾è„¸ã€‚

### opencv ç¯å¢ƒå®‰è£…

ç”±äºå¼€å‘å¹³å°æ˜¯ OSX ï¼Œè€Œ OSX æœ‰ Homebrew ç¥å™¨
```bash
# å®‰è£… Homebrew
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

# è®¾ç½® Homebrewé•œåƒä»£ç†ï¼Œå›½å†…ä¸‹è½½åŠ é€Ÿ
cd "$(brew --repo)"
git remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git
cd "$(brew --repo)/Library/Taps/homebrew/homebrew-core"
git remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git
brew update
echo 'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles' >> ~/.bash_profile
source ~/.bash_profile

# å®‰è£… opencv
brew tap homebrew/science
brew install opencv
```

### node addons

node addons æ˜¯åœ¨ node ç¯å¢ƒè°ƒç”¨ C ç³»åˆ—æ¥å£çš„æ–¹æ³•ï¼Œå·²ç»æœ‰äººç”¨è¯¥æ–¹æ³•å†™è¿‡ [`node-opencv`](https://github.com/peterbraden/node-opencv)ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šæˆ‘è¿˜åŠ ä¸Šäº† `CircleLBP` `RectLBP` `ToThreeChannels` `PCA` ç®—æ³•ï¼Œ`ToThreeChannels` æ˜¯å°† å•é€šé“ï¼ˆç°ï¼‰æˆ–è€… RGBA é€šé“å˜æˆ RGB é€šé“ã€‚
```cpp
NAN_METHOD(Matrix::ToThreeChannels) {
  Nan::HandleScope scope;
  Matrix *self = Nan::ObjectWrap::Unwrap<Matrix>(info.This());
  cv::Mat image;

  if (self->mat.channels() == 3) {
    image = self->mat;
  } else if (self->mat.channels() == 1) {
    cv::Mat myimg = self->mat;
    cv::cvtColor(myimg, image, CV_GRAY2RGB);
  } else if(self->mat.channels() == 4){
    cv::Mat myimg = self->mat;
    cv::cvtColor(myimg, image, CV_BGRA2RGB);
  } else {
    Nan::ThrowError("those channels are not supported");
  }

  self->mat = image;
  info.GetReturnValue().Set(Nan::Null());
}
```

### å›¾ç‰‡é¢„å¤„ç†ï¼ˆäººè„¸æ£€æµ‹...ï¼‰

é€šé“ç»Ÿä¸€ => ç°åŒ– => çº§è”åˆ†ç±»å™¨æ£€æµ‹äººè„¸ => äººè„¸å°ºå¯¸ç»Ÿä¸€ => ä¿å­˜

ç»è¿‡å¤šæ¬¡å°è¯•åï¼Œå¯¹äºå­¦ç”Ÿè¯ä»¶ç…§ï¼Œæœ€ç»ˆæ¯”è¾ƒå¾—å‡ºï¼Œé‡‡ç”¨ LBP çº§è”åˆ†ç±»å™¨ï¼Œçª—å£æ”¾å¤§ 1.95 å€å·¦å³æ•ˆæœè¾ƒå¥½ã€‚ï¼ˆæµ‹è¯•æ•°æ®åœ¨ `backend/data/summary.json`ï¼‰

![](https://ooo.0o0.ooo/2017/01/22/5884929797559.jpg)
![](https://ooo.0o0.ooo/2017/01/22/588492ae5471e.jpg)

### è¯†åˆ«ç®—æ³•æµ‹è¯•ä¸ç¡®å®š

æ¯”è¾ƒ opencv ä¸­ä¸‰ç§äººè„¸è¯†åˆ«ç®—æ³•ï¼ŒEigenã€Fisherã€LBPHã€‚æ•°æ®åœ¨`backend/cpptest/` ä¸­

<table border="0">
ã€€<caption><em>opencv äººè„¸è¯†åˆ«ç®—æ³•æ¯”è¾ƒ</em></caption>
ã€€<tr>
ã€€<th rowspan="2" style="text-align: center;">ç®—æ³•/æ—¶é—´(ms)</th>
ã€€<th colspan="2">å®éªŒ1</th>
ã€€<th colspan="2">å®éªŒ2</th>
ã€€<th colspan="2">å®éªŒ3</th>
ã€€<th colspan="2">å®éªŒ4</th>
ã€€<th colspan="2">å®éªŒ5</th>
ã€€<tr>
ã€€<td>è®­ç»ƒ<td>é¢„æµ‹<td>è®­ç»ƒ<td>é¢„æµ‹<td>è®­ç»ƒ<td>é¢„æµ‹<td>è®­ç»ƒ<td>é¢„æµ‹<td>è®­ç»ƒ<td>é¢„æµ‹</td>
ã€€<tr><th>Eigen<td>0.030648<td>0.010711<td>0.025524<td>0.011132<td>0.029332<td>0.007791<td>0.036231<td>0.020043<td>0.026972<td>0.005711</td>
ã€€<tr><th>Fisher<td>0.040043<td>0.0089<td>0.039244<td>0.007145<td>0.033777<td>0.008276<td>0.043099<td>0.013723<td>0.039407<td>0.015095</td>
ã€€<tr><th>LBPH<td>0.035812<td>0.071586<td>0.034822<td>0.075267<td>0.03204<td>0.067166<td>0.039263<td>0.075726<td>0.053047<td>0.074361</td>
</table>

ç»¼åˆæ¯”è¾ƒå¯ä»¥å¾—å‡ºï¼Œæ•ˆç‡ Eigen > Fisher > LBPH  
æ‰€ä»¥é‡‡ç”¨Eigenï¼ˆç‰¹å¾è„¸ï¼‰ç®—æ³•

### å­¦ç”Ÿä¿¡æ¯æ¥å£ï¼ˆçˆ¬è™«ï¼‰

è¯¥ç³»ç»Ÿè¿˜éœ€è¦è·å–åˆ°å­¦ç”Ÿçš„ä¸ªäººä¿¡æ¯ï¼Œæ¯”å¦‚é€šè¿‡å­¦å·å’Œå¯†ç éªŒè¯æ˜¯å¦æ­£ç¡®ç­‰ç­‰ã€‚åœ¨åŒä¸€å±Šçš„åŒå­¦ä¸­ï¼Œå·²ç»æœ‰ä¸€ä½åŒå­¦ç ”ç©¶æ•™åŠ¡ç³»ç»Ÿæ¯”è¾ƒé€å½»äº†ï¼Œè€Œä¸”åšäº†ä¸€ä¸ª[æŸ¥å—å¸ˆ](http://njnu.chaiziyi.com.cn/)ç½‘ç«™ï¼Œæ‰€ä»¥æˆ‘åªéœ€è¦çˆ¬å–è¯¥ç½‘ç«™çš„æ¥å£å³å¯ã€‚

### å‰ç«¯

è¯¥ç³»ç»Ÿä½¿ç”¨çš„æ˜¯å‰åç«¯åˆ†ç¦»çš„æ¶æ„ï¼Œé¡µé¢çš„æ¸²æŸ“äº¤ç»™å®¢æˆ·ç«¯ `JavaScript` æ¥å®ç°ï¼Œåç«¯åªéœ€è¦æä¾›çº¯æ•°æ®æ¥å£å³å¯ï¼Œè®©åç«¯çš„å·¥ä½œæ›´åŠ çº¯ç²¹ã€‚  

å¯¹äºé¡µé¢è·¯ç”±çš„æ§åˆ¶ï¼Œä½¿ç”¨çš„æ˜¯ HTML5 çš„ [History API](https://developer.mozilla.org/en-US/docs/Web/API/History) ï¼Œäº¤ç»™ JavaScript æ¥æ§åˆ¶ï¼Œæ‰€ä»¥åªè¦ä¸è¿›è¡Œé¡µé¢çš„å¼ºåˆ¶åˆ·æ–°ï¼ˆCtrl/cmd + Rï¼‰ï¼Œæ‰€æœ‰è·¯å¾„çš„è·³è½¬éƒ½æ˜¯ä¸ä¼šä»æœåŠ¡å™¨è·å– HTML CSS è¿›è¡Œæ¸²æŸ“ï¼Œè¿™å°±æ˜¯å•é¡µ Web åº”ç”¨çš„æ ¸å¿ƒï¼Œè¿™æ ·ä¸€æ¥ï¼Œç”¨æˆ·ä½“éªŒå°±æ›´ä½³ï¼ŒæœåŠ¡å™¨è´Ÿè½½ä¹Ÿæ›´å°ï¼Œä½†å¯¹äºæµè§ˆå™¨è¦æ±‚æ›´é«˜äº†ã€‚

ç»“åˆ React Web Component å’Œ [CSS Module](https://github.com/css-modules/css-modules) æ€æƒ³ï¼Œå°†å‰ç«¯é¡µé¢ç»†åˆ†ä¸ºè‹¥å¹²ä¸ªç»„ä»¶ï¼Œåœ¨ä¸Šå±‚ Page ä¸­è¿›è¡Œæ•°æ®çš„ä¼ è¾“ï¼Œç»„ä»¶çš„ç»„åˆï¼Œåœ¨ Page ä¸Šå±‚è¿˜æœ‰ä¸€å±‚ Appï¼ŒæŠŠä¸€äº›å…¨å±€é€šç”¨çš„ç»„ä»¶æ”¾è¿™ã€‚
![](https://ooo.0o0.ooo/2017/01/22/58845e6781176.jpg)

è€Œä¸”æ‰€æœ‰çš„æ•°æ®æ§åˆ¶éƒ½åœ¨ `reducer` ä¸­ï¼Œå±‚æ¬¡æ¸…æ™°ï¼Œä»£ç å¤ç”¨æ€§é«˜ã€‚

![](https://ooo.0o0.ooo/2017/01/22/58845a7e4a302.jpg)
```
app/
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ storage.js
â”‚   â””â”€â”€ utils.js
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â””â”€â”€ style.less
â”‚   â”œâ”€â”€ FaceRec/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â””â”€â”€ style.less
â”‚   â”œâ”€â”€ Header/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â””â”€â”€ style.less
â”‚   â”œâ”€â”€ .../
â”‚   â””â”€â”€ Toast/
â”‚       â”œâ”€â”€ index.js
â”‚       â””â”€â”€ style.less
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ AboutPage.js
â”‚   â”œâ”€â”€ AdminLoginPage.js
â”‚   â”œâ”€â”€ AdminPage.js
â”‚   â”œâ”€â”€ AudioImportPage.js
â”‚   â”œâ”€â”€ FaceImportPage.js
â”‚   â””â”€â”€ StuSignPage.js
â”œâ”€â”€ reducers/
â”‚   â”œâ”€â”€ about.js
â”‚   â”œâ”€â”€ actions.js
â”‚   â”œâ”€â”€ active.js
â”‚   â”œâ”€â”€ admin.js
â”‚   â”œâ”€â”€ appReducers.js
â”‚   â”œâ”€â”€ audioImport.js
â”‚   â”œâ”€â”€ base.js
â”‚   â”œâ”€â”€ faceImport.js
â”‚   â””â”€â”€ upFace.js
â”œâ”€â”€ workers/
â”‚   â””â”€â”€ face.worker.js
â”œâ”€â”€ App.js
â”œâ”€â”€ index.tpl.html
â”œâ”€â”€ main.js
â””â”€â”€ router.js
```

å…¶ä¸­ `workers/face.worker.js` æ–‡ä»¶æ˜¯åˆ©ç”¨ Web Worker èµ·çš„å¦ä¸€ä¸ªè¿›ç¨‹ä»£ç ï¼Œä¸»è¦åšçš„æ˜¯è¾“å…¥å›¾ç‰‡æ•°æ®ï¼Œè¾“å‡ºäººè„¸çš„ä½ç½®å¤§å°ï¼Œå°±æ˜¯ JavaScript ç‰ˆçš„äººè„¸æ£€æµ‹ï¼Œä¹‹æ‰€ä»¥èµ·å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ˜¯å› ä¸ºå¯¹äºè§†é¢‘çš„äººè„¸æ£€æµ‹ï¼Œå¯¹äºå®æ—¶æ€§è¦æ±‚ä¹Ÿæ¯”è¾ƒé«˜ï¼Œæ£€æµ‹ä¹Ÿæ¯”è¾ƒè€—æ—¶ï¼Œä¸ºäº†æ•ˆç‡è€ƒè™‘ä½¿ç”¨äº† Web Workerã€‚ 

![ClipboardImage](https://ooo.0o0.ooo/2017/01/23/5884dfc84c74c.jpg)

### åç«¯

ç”±äºè§†å›¾çš„æ¸²æŸ“éƒ½äº¤ç»™æµè§ˆå™¨äº†ï¼Œæ‰€ä»¥åç«¯ä¸»è¦å°±æ˜¯å¯¹äºæ•°æ®çš„é€»è¾‘å¤„ç†äº†ï¼Œæ¯”å¦‚æ ·æœ¬å½•å…¥ï¼Œå­¦ç”Ÿä¿¡æ¯æŸ¥è¯¢ï¼ˆçˆ¬è™«ï¼‰ï¼Œäººè„¸è¯†åˆ«ï¼ˆè°ƒç”¨ opencv ï¼‰ï¼ŒåŒæ—¶ä½¿ç”¨ mysql æ•°æ®åº“ï¼Œå­˜å‚¨æ ·æœ¬å½•å…¥çš„ä¿¡æ¯ï¼Œè¡¨ç»“æ„å¦‚ä¸‹ï¼š
```
Table gp.`face_import`
+----------+--------------+------+-----+---------+-------+
| Field    | Type         | Null | Key | Default | Extra |
+----------+--------------+------+-----+---------+-------+
| stuid    | varchar(20)  | NO   |     | NULL    |       |
| time     | datetime     | NO   |     | NULL    |       |
| hash     | varchar(20)  | NO   | PRI | NULL    |       |
| face_url | varchar(100) | NO   |     | NULL    |       |
+----------+--------------+------+-----+---------+-------+
```
`hash` æ˜¯æ¯æ¬¡ä¸Šä¼ æ ·æœ¬çš„å”¯ä¸€ key å€¼ï¼ŒåŒæ—¶ä¸ºäº†æ–¹ä¾¿ç³»ç»Ÿçš„éƒ¨ç½²è¿ç§»ï¼Œæ²¡æœ‰å°†ä¸Šä¼ çš„æ ·æœ¬æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­ï¼Œè€Œæ˜¯å­˜åœ¨ [sm.ms](https://sm.ms) å…è´¹å›¾åºŠä¸­ï¼Œå¾—åˆ°ä¸€ä¸ª `face_url` å­—æ®µï¼Œæ¯æ¬¡å¯åŠ¨æœåŠ¡å™¨ä¹‹å‰éƒ½å¾—è¿›è¡Œæ ·æœ¬çš„è®­ç»ƒæˆ–è€…è®­ç»ƒæ•°æ®çš„è¯»å–ï¼›è€Œä¸”æ¯æ¬¡ä¸Šä¼ æ ·æœ¬æˆ–è€…åˆ é™¤æ ·æœ¬åï¼ŒæœåŠ¡å™¨éƒ½éœ€è¦é‡æ–°è®­ç»ƒä¿å­˜æ ·æœ¬ï¼Œé‡æ–°ç”Ÿæˆä¸€å¥—ç‰¹å¾è„¸ã€‚   

å¹¶ä¸”åœ¨å¼€å¯æœåŠ¡å™¨çš„ç¯å¢ƒå’Œçº¯ç²¹çš„æ•°æ®å¤„ç†çš„ç¯å¢ƒå¯¹äºæ•°æ®åº“çš„å¤„ç†æ˜¯ä¸ä¸€æ ·çš„ï¼Œåœ¨æœåŠ¡å™¨ç¯å¢ƒï¼Œéœ€è¦å¼€å¯æ•°æ®åº“è¿æ¥æ± ï¼Œæ¯æ¬¡éƒ½ä»ä¸­å»å–å‡ºè¿æ¥è¿›è¡Œæ•°æ®æ“ä½œï¼›è€Œçº¯ç²¹çš„è¯»å–æ•°æ®åº“ï¼Œå¾—åˆ°`face_url`è¿›è¡Œäººè„¸çš„é¢„å¤„ç†æˆ–è®­ç»ƒï¼Œåˆ™åªéœ€è¦æ¯æ¬¡å•ç‹¬çš„ å¼€å¯è¿æ¥ => è¯»å–æ•°æ® => å…³é—­è¿æ¥ å³å¯ï¼Œå¦åˆ™ç¨‹åºä¼šä¸€ç›´è¿è¡Œä¸‹å»ï¼Œå› ä¸ºæ•°æ®åº“è¿æ¥æ± æ²¡å…³é—­ã€‚

åŒæ—¶ï¼Œæ‰€æœ‰çš„å‰ç«¯æ•°æ®æ¥å£éƒ½æ˜¯ `/api/*` è§„åˆ™ï¼ŒåŒæ—¶å¯¹äºç®¡ç†å‘˜çš„ç”¨æˆ·åå’Œå¯†ç ä¼šè¿›è¡Œ md5 ä¸å¯é€†ç¼–ç ç„¶åå†ä¼ è¾“ï¼Œé˜²æ­¢è¢«ä»–äººæ•æ‰åˆ°ã€‚

### åŒæ„æ¸²æŸ“

ä¸Šæ–‡è¯´åˆ°æ‰€æœ‰çš„é¡µé¢æ¸²æŸ“éƒ½æ˜¯äº¤ç»™ JavaScript æ§åˆ¶ï¼ŒæœåŠ¡å™¨è¿”å›çš„ HTMLç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š
```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>å—å¸ˆå¤§å­¦ç”Ÿç­¾åˆ°ç³»ç»Ÿ</title>
    <link rel="stylesheet" type="text/css" href="/pace.min.css">
    <script type="text/javascript" src="/pace.min.js"></script>
<link href="/style.min.css?v=b5afb06f45be775a70081c1e320e6c40" rel="stylesheet"></head>
<body>
    <div id="app"><!--HTML--></div>
<script type="text/javascript" src="/libs.min.js?v=8d589c56bcac1e2c17a7"></script>
<script type="text/javascript" src="/app.main.min.js?v=448dfe9c907942d09623"></script></body>
</html>

```

å…¶ä¸­ä»»ä½•æ•°æ®éƒ½æ˜¯æ²¡æœ‰çš„ï¼Œåªæœ‰ â€œç¬¬äºŒæ—¶é—´â€ é€šè¿‡ `app.min.js` æ‰§è¡Œ JavaScript è¿›è¡Œæ¸²æŸ“ï¼Œæ‰€ä»¥å¯¹äºç”¨æˆ·çŸ­æš‚çš„ â€œç¬¬ä¸€æ—¶é—´â€ æ„Ÿè§‰æ˜¯ä¸å¥½çš„ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ â€œé¦–å±æ¸²æŸ“â€ï¼Œä¼˜åŒ–é¦–å±æ¸²æŸ“ï¼Œå°±éœ€è¦é€šè¿‡æœåŠ¡å™¨è¿”å›å¸¦å†…å®¹çš„ HTMLã€‚  


ç”±äºå‰ç«¯ä½¿ç”¨çš„æ˜¯ `react`ï¼Œå°† HTML æŠ½è±¡æˆä¸º `JSX`ï¼Œå°† DOMæ“ä½œ è½¬åŒ–æˆçŠ¶æ€çš„å˜åŒ–ï¼Œé‡æ–°æ¸²æŸ“çš„æ€æƒ³ï¼Œæ‰€ä»¥ä½¿å¾—**æœåŠ¡å™¨ç«¯ä¹Ÿèƒ½å¤Ÿè§£æ`react`**ï¼Œ`redux` åˆå°†çŠ¶æ€çš„æ›´æ–°æ“ä½œæŠ½ç¦»å‡ºæ¥ï¼Œä½¿å¾—æœåŠ¡å™¨ç«¯å¯ä»¥æ›´æ–¹ä¾¿çš„æ§åˆ¶çŠ¶æ€ä»è€Œè¿›è¡Œæ¸²æŸ“ï¼ˆå½“ç„¶ï¼Œåªæœ‰ nodejs ä½œä¸ºåç«¯æ¸²æŸ“å±‚æ‰å¯ä»¥åšåˆ°ï¼‰ï¼ŒåŒæ—¶ç”±äºå‰ç«¯ä½¿ç”¨ Babel ç¼–è¯‘å‰ç«¯ä»£ç ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ–°å‹è¯­æ³•ç³–ï¼Œä¸ºäº†æœåŠ¡å™¨ç«¯ä¹Ÿèƒ½å¤Ÿè¯†åˆ«ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦ babel-register

```
import React from 'react';
import {renderToString} from 'react-dom/server'
import reactRouter, {match, RouterContext} from 'react-router'
import {Provider} from 'react-redux'
import MyRouter, {configureStore} from 

// This is fired every time the server side receives a request
function handleRender(req, res, next) {
    match({ routes: MyRouter, location: req.url }, function(error, redirectLocation, renderProps) {
        if (error) {
            res.status(500).send(error.stack);
        } else if (redirectLocation) {
            if(req.url.startsWith('/api') || fs.existsSync(path.join(fePath, url.parse(req.url).pathname)) ) {
                next();
            } else {
                res.redirect(302, redirectLocation.pathname + redirectLocation.search);
            }
        } else if (renderProps) {
            var store = configureStore();
            // console.log(renderProps, store);
            // we can invoke some async operation(eg. fetchAction or getDataFromDatabase)
            // call store.dispatch(Action(data)) to update state.
            store.dispatch(pushRoute(req.url))
            if(req.url === '/about') {
                store.dispatch(fetchRemoteMdText())
                .then(data => {
                    res.renderStore(store, renderProps);
                })
            } else {
                res.renderStore(store, renderProps);
            }

        } else {
            res.status(404).send('Not found')
        }
    })
}

express.response.renderStore = function (store, renderProps) {
    const html = renderToString(
        <Provider store={store}>
            <RouterContext {...renderProps} />
        </Provider>
    );
    this.header('content-type', 'text/html; charset=utf-8')
    this.send(renderFullPage('å—å¸ˆå¤§åˆ·è„¸ç­¾åˆ°ç³»ç»Ÿ', html, store.getState()))
}

const htmlPath = path.join(fePath, 'index.html');
var html = fs.readFileSync(htmlPath).toString();

function renderFullPage(title, partHtml, initialState) {
    // <!--HTML-->
    var allHtml = html;
    if(initialState) {
        allHtml = allHtml.replace(/\/\*\s*?INITIAL_STATE\s*?\*\//, `window.__INITIAL_STATE__=${JSON.stringify(initialState)}`)
    }
    if(title) {
        allHtml = allHtml.replace(/<title>[\s\S]*?<\/title>/, `<title>${title}</title>`);
    }
    return allHtml.replace(/<!--\s*?HTML\s*?-->/, partHtml);

}
```

åŒæ—¶è®©æµè§ˆå™¨å¾—åˆ°åˆå§‹çŠ¶æ€ï¼Œ`window.__INITIAL_STATE__=${JSON.stringify(initialState)}`ï¼ŒæŠŠåˆå§‹çŠ¶æ€`window.__INITIAL_STATE__`
ä¼ ç»™å®¢æˆ·ç«¯
```
const isBrowser = (() => !(typeof process === 'object' && typeof process.versions === 'object' && typeof process.versions.node !== 'undefined'))();

var _initState = isBrowser && window.__INITIAL_STATE__ || initState
const store = configureStore(
    _initState
)
```

ä»¥ä¸Šï¼Œä¾¿å¯ä»¥å®ç°åŒæ„æ¸²æŸ“ï¼Œæ—¢ä¿è¯äº† SPA çš„ç”¨æˆ·ä½“éªŒï¼Œé¦–å±æ¸²æŸ“ï¼Œè€Œä¸”è§£å†³äº†SEOï¼ˆæœç´¢å¼•æ“ä¼˜åŒ–ï¼‰çš„é—®é¢˜ã€‚

### éƒ¨ç½²

å¼€å‘çš„å·®ä¸å¤šåï¼Œæ‰¾æœ‹å‹è¦äº†ä¸ª ubuntu çš„æœåŠ¡å™¨ï¼Œé¦–å…ˆéº»çƒ¦çš„å°±æ˜¯ç¯å¢ƒçš„è¿ç§»äº†ï¼Œç”±äºæºç éƒ½éƒ¨ç½²åœ¨ GitHub ä¸Šï¼Œæ‰€ä»¥ç›´æ¥ `git clone` å°±å¯ä»¥å¾—åˆ°äº†ï¼ˆåŸå§‹è¯ç…§å’Œé¢„å¤„ç†åçš„è¯ç…§ã€è®­ç»ƒçš„ yaml æ•°æ®éƒ½æ²¡æäº¤è‡³ GitHubï¼Œæ‰€ä»¥ä»£ç åº“è¿˜æ˜¯æŒºå°çš„ï¼‰ã€‚

ç„¶å Ubuntu ä¸Šå®‰è£… opencvï¼ŒUbuntu ä¸Šå¯æ²¡æœ‰ Homebrew ç¥å¥‡ï¼Œæ‰€ä»¥åªèƒ½ä¸‹è½½æºç åŒ…ï¼Œè‡ªå·±è¿›è¡Œç¼–è¯‘è¿æ¥ï¼Œç”ŸæˆåŠ¨æ€é“¾æ¥åº“

å®‰è£…å¥½ node + npm + nvmï¼Œnode ç‰ˆæœ¬ â‰¥7.0ï¼Œä»¥åŠ mysqlï¼Œå¯¼å…¥ gp.sql



å†åœ¨æœåŠ¡å™¨æ‰§è¡Œ `npm install`ï¼ˆå®‰è£…é¡¹ç›®ä¾èµ–åŒ…ï¼Œå„ä¸ªç›®å½•ä¸‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ä¾èµ–åŒ…ï¼Œå‰ç«¯ç›®å½•åˆ™ä¸å¿…å®‰è£…ï¼Œå› ä¸ºåªéœ€è¦å…¶äº§ç”Ÿçš„ä»£ç ï¼‰ => ä¸‹è½½è„šæœ¬ => é¢„å¤„ç†è„šæœ¬ => è®­ç»ƒæ ·æœ¬è„šæœ¬ => å¯åŠ¨æœåŠ¡å™¨

### nginx + https

ä½†æ˜¯æœåŠ¡å™¨å¯åŠ¨åï¼Œå¤–ç½‘è¿˜æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œéœ€è¦é€šè¿‡ nginx åå‘ä»£ç†ï¼ŒåŒæ—¶è§£æåŸŸåè‡³æœåŠ¡å™¨ IPï¼Œä¸ºäº†æµè§ˆå™¨å®‰å…¨å¯ä»¥æ‰“å¼€æ‘„åƒå¤´ï¼Œè¿˜éœ€è¦å¼€å¯ HTTPs åè®®ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯è…¾è®¯äº‘å…è´¹çš„ä¸€å¹´è¯ä¹¦ï¼Œç„¶å nginx é…ç½®åå³å¯ã€‚

### SEO

ä¸ºäº†å¢å¼ºç«™ç‚¹çš„æ›å…‰ç‡ï¼Œå°±éœ€è¦åš SEO äº†ï¼Œæ·»åŠ  `robots.txt`ï¼Œç«™ç‚¹åœ°å›¾ï¼ŒåŒæ—¶åœ¨å‰ç«¯é¡µé¢åŠ å…¥ä¸å¯è§çš„ `a` æ ‡ç­¾ï¼Œåˆ©äºç½‘é¡µçˆ¬è™«çˆ¬å–å…¶ä»–é“¾æ¥

![](https://ooo.0o0.ooo/2017/01/22/5884a45f49cae.jpg)

### PC Desktop

ä¸ºäº†æ–¹ä¾¿å¸ˆç”Ÿä½¿ç”¨ï¼Œè¿˜ä½¿ç”¨ `nativefier` å°†ç«™ç‚¹æ‰“åŒ…æˆ PC Desktopï¼Œå…¶å®å°±æ˜¯å°†ç«™ç‚¹ URL å’Œ Chrome å†…æ ¸ç»„åˆæˆä¸€ä¸ª Application

## ä»£ç è§£æï¼ˆCode Analysisï¼‰

ä¸‹é¢å¯¹æŸäº›ä»£ç è¿›è¡Œå‰–æ

### è·å–IDé›†åˆ

```javascript
// gp-image-download/lib/get-all-id.js
// language: javascript
// env: node
// usage: (cd gp-image-download && node get-all-id.js)

const URL = "http://urp.njnu.edu.cn/authorizeUsers.portal"
const STU_FILE = "data/students.json"
// éœ€è¦åœ¨æµè§ˆå™¨å…ˆç™»å½•ï¼Œå¾—åˆ°å·²ç™»å½•çš„ Cookie
const COOKIE = "njnuurpnew=ac16c83bd341d8ba0c3f2f092378; JSESSIONID=0001gcUXI0GWjdQg_ptI6NGAFaf:-5B0INP"

/* è¯·æ±‚ URLï¼Œå†™å…¥ COOKIEï¼Œå¾—åˆ°æ•°æ®ä¸ªæ•° recordCount */
async function getLimit() {
    try {
        const x = await get({
            ...url.parse(URL),
            headers: { cookie: COOKIE }
        })
        // console.log('xx', x)
        const json = JSON.parse(x)
        return json.recordCount
    } catch (ex) {
        console.error(ex);
    }
}

/* è¯·æ±‚ URLï¼Œå†™å…¥ COOKIEï¼Œå¾—åˆ°å…¨éƒ¨å­¦ç”Ÿé›†åˆ */
async function getStuIds(limit) {
    try {
        const x = await get({
            ...url.parse(URL+"?limit="+limit),
            headers: { cookie: COOKIE }
        })

        const json = JSON.parse(x)
        return json.principals.filter(x=>{
            let metier = x.metier.trim();
            return metier=='æœ¬ä¸“ç§‘ç”Ÿ'
        })
    } catch (ex) {
        console.error(ex);
    }
}

/* ç”±äºå…¨éƒ¨å­¦ç”Ÿæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥å†™å…¥æ–‡ä»¶ï¼Œä¸‹æ¬¡è¯»å–æ–‡ä»¶å³å¯ */
async function writeStudents() {
    const limit = await getLimit()
    const stus = await getStuIds(limit)

    console.log('writing "%s"', STU_FILE)
    fs.writeFileSync(STU_FILE, JSON.stringify(stus, null, 4))

    assignStuIds()
}

/* è¯»å–å…¨éƒ¨å­¦ç”Ÿæ•°æ®ï¼ŒæŒ‰ç…§å…¥å­¦å¹´ä»½åŒºåˆ†ï¼Œå¾—åˆ°ä»¥\r\nåˆ†å‰²çš„å­¦å·é›†åˆæ–‡ä»¶ */
function assignStuIds() {
    const stus = JSON.parse(fs.readFileSync(STU_FILE))

    let all = stus.reduce((p, n) => {
        //19130126
        if(/^[\d]{8}$/.test(n.id)) {
            let num = n.id.substr(2, 2);
            let year = "20"+num;
            if(year>YEAR || isNaN(num)) return p
            p[year] = p[year] || ''
            p[year] += n.id+'\r\n'
        }
        return p
    }, {})

    Object.keys(all).forEach(k =>{
        let v = all[k];
        console.log('writing "%s"', "data/student-ids-"+k+".txt")
        fs.writeFile("data/student-ids-"+k+".txt", v.replace(/\r\n$/, ''), ()=>{})
    })
}

```

### ä¸‹è½½å›¾ç‰‡è„šæœ¬

```bash
#!/bin/bash
// gp-image-download/download.sh
// language: bash script
// env: bash
// usage: (cd gp-image-download && ./download.sh 2013)

base="http://223.2.10.123/jwgl/photos/rx"
year="2013"

# æ²¡æœ‰ images/ æ–‡ä»¶å¤¹åˆ™æ–°å»ºï¼Œå¥å£®æ€§
if [ ! -d images ]; then
    echo mkdir images
    mkdir images
fi
cd images
# å°†yearèµ‹å€¼ä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œé»˜è®¤ä¸º 2013
if [ ! -z "$1" ]; then
    year=$1
fi
echo year=$year

if [ ! -d $year ]; then
    echo mkdir $year
    mkdir $year
fi
cd $year

# è¯»å–ä¸Šä¸€æ­¥è·å–çš„å­¦å·é›†åˆï¼Œæ”¾å…¥arr
while IFS=$'\r\n' read var; do
    arr+=($var)
done < ../../data/student-ids-$year.txt

# å°†ä¸‹è½½å¥½çš„å›¾ç‰‡ï¼ŒæŒ‰ç…§ å­¦å¹´/ç­çº§/å›¾ç‰‡ æ”¾ç½®
assign_file() {
    Name=${1##*/}
    Classno=${Name:0:6}
    if [ ! -d $Classno ]; then
        mkdir $Classno
    fi
    mv $Name "$Classno"/
}

# ä¸‹è½½å›¾ç‰‡
# params: $1 url; $2 filename
down() {
    URL=$1
    Name=$2
    data=`curl --fail --silent $URL` 
    # "$data" ä¸èƒ½å°‘  å› ä¸ºdataä¸­å¯èƒ½åŒ…å«[]
    if [ ! -z "$data" ]; then
        curl --fail --silent $URL > $Name
        echo "SUCCESS! $URL"
    fi
}

# éå†arrï¼Œä¸‹è½½
for id in ${arr[@]}; do
    if [ ! -z $id ]; then
        Name=${id//$\s/}.jpg
        down "$base""$year"/$Name $Name
    fi
done

# ä¸‹è½½ç»“æŸåï¼Œé‡æ–°æ”¾ç½®æ–‡ä»¶
arr=(*)
for x in ${arr[@]}; do
    assign_file $x
done
```

### npm è„šæœ¬

```text
// gp-njnu-photos-backend/package.json
// usage: (cd gp-njnu-photos-backend && npm run $scriptName)

# å›¾ç‰‡é¢„å¤„ç†
# detect face, then gray, save
# eg.  $ npm run grayface 2013 191301
#      $ npm run grayface 2013
#      $ npm run grayface
# npm run grayface year classno


# æ ·æœ¬è®­ç»ƒå¹¶å†™å…¥æ–‡ä»¶ã€‚
# after read grayface images, then train and save it
# eg.  $ node pretreat/train_save.js -f --args 2013
#      $ node pretreat/train_save.js -f --args 2013 191301
# -fï¼šé‡æ–°è®­ç»ƒï¼Œä¸è®ºæ˜¯å¦å·²å­˜åœ¨è®­ç»ƒæ•°æ®
# --args year classno è®­ç»ƒå“ªä¸€å¹´å“ªä¸€ç­çº§çš„å›¾ç‰‡

"grayface": "node pretreat/gray_face.js",
"train:force": "node pretreat/train_save.js -f",
"train:smart": "node pretreat/train_save.js",
"dev:w": "cross-env NODE_STATUS=run, NODE_ENV=dev node .",
"dev": "cross-env NODE_STATUS=run, NODE_ENV=dev node index.js",
"start": "cross-env NODE_STATUS=run, NODE_ENV=prod node index.js",
"retrain": "npm run grayface && npm run train:force",
"retrain:dev": "npm run grayface 2013 191301 && node pretreat/train_save.js -f --args 2013 191301",
```

### å¼€å‘ç¯å¢ƒï¼ˆçƒ­éƒ¨ç½²ï¼‰è„šæœ¬

```javascript
// gp-njnu-photos-backend/provider.js
// language: javascript
// env: node
// usage: (cd gp-njnu-photos-backend && npm run dev:w)

var cp = require('child_process')
var p = require('path')
var fs = require('fs')

const isDir = (filepath) => fs.statSync(filepath).isDirectory()

/* å»é™¤æ‰ éæ–‡ä»¶å¤¹ï¼Œnode_modulesæ–‡ä»¶å¤¹ï¼Œ`.`å¼€å¤´çš„æ–‡ä»¶å¤¹ */
const children = fs.readdirSync(__dirname).filter(n=>n!='node_modules' && !n.startsWith('.') && isDir(p.join(__dirname, n)));

[__dirname].concat(children).forEach(dir => fs.watch(dir, watchHandle))

/* ç›‘å¬åˆ°æ–‡ä»¶è¢«ä¿®æ”¹åˆ™è§¦å‘ */
function watchHandle (type, filename) {
    // æ— è§†ä¸æ˜¯jsæ–‡ä»¶å’Œç‚¹å¼€å¤´å‘½åçš„æ–‡ä»¶
    if(filename.startsWith('.') || !filename.endsWith(".js")) {
        return;
    }

    console.log(type, filename);
    // æ€æ­»å†…å­˜ä¸­çš„æœåŠ¡å™¨è¿›ç¨‹
    serverProcess.kill('SIGINT');
    serverProcess = runServer();
}

var serverProcess = runServer();
/* fork index.js è¿›ç¨‹ */
function runServer() {
    return cp.fork('./index.js', process.argv, {stdio: [0, 1, 2, 'ipc']})
}
```

### æœåŠ¡å™¨è‡ªåŠ¨æ›´æ–°ä»£ç 

- æœåŠ¡å™¨ç«¯

```javascript
// gp-njnu-photos-backend/routes/control.js

/* è®¿é—® /api/ctrl/pull æœåŠ¡å™¨æ‰§è¡Œ git pullï¼Œä» github æ›´æ–°ä»£ç  */
ctrl.all('/pull', (req, res) => {
    res.writeHead(200, {
        'Content-Type': 'text/event-stream',
        'Cache-Control': 'no-cache',
        'Connection': 'keep-alive'
    });
    var ls = require('child_process').spawn('git', ['pull', 'origin', 'master'])
    ls.stdout.on('data', (data) => {
        data = data.toString()
        console.log(data)
        res.write(`${data}`);
    });

    ls.stderr.on('data', (data) => {
        data = data.toString()
        console.log(data)
        res.write(`${data}`);
    });
    ls.on('close', (code) => {
        console.log(`child process exited with code ${code}`)
        res.end(`child process exited with code ${code}`);
    });

})
```

- æœ¬æœºï¼ˆå¼€å‘æœºï¼‰

```bash
// path.sh
#!/bin/bash

msg="from bash"
if [ -n "$1" ]; then
    msg=$1
    # é‡æ–° build å‰ç«¯ä»£ç 
    (cd gp-njnu-photos-app && npm run build)
fi

git add .
git commit -m "$msg"
git push

# å¦‚æœpushæˆåŠŸï¼ˆexitcode=0ï¼‰ï¼Œåˆ™è®¿é—®è¿œç«¯ /api/ctrl/pullï¼Œä»è€ŒæœåŠ¡å™¨ä¹Ÿæ›´æ–°äº†ä»£ç 
if [ $? = 0 ]; then
    curl https://face.moyuyc.xyz/api/ctrl/pull
fi
```

### Desktopæ‰“åŒ…è„šæœ¬

```text
// package.json
// usage: npm run script-name

"app:mac64": "set ELECTRON_MIRROR=https://npm.taobao.org/mirrors/electron/ && nativefier -c -a x64 -p mac --insecure -n å¤å—å¸ˆå¤§åˆ·è„¸ç­¾åˆ° https://face.moyuyc.xyz/ -i desktop/logos/logo.icns --disable-dev-tools --disable-context-menu desktop",
"app:mac32": "set ELECTRON_MIRROR=https://npm.taobao.org/mirrors/electron/ && nativefier -c -a ia32 -p mac --insecure -n å¤å—å¸ˆå¤§åˆ·è„¸ç­¾åˆ° \"https://face.moyuyc.xyz/\" -i desktop/logos/logo.icns --disable-dev-tools --disable-context-menu desktop",
"app:mac": "npm run app:mac32 & npm run app:mac64",
"app:win": "npm run app:win32 & npm run app:win64",
"app:win32": "set ELECTRON_MIRROR=https://npm.taobao.org/mirrors/electron/ && nativefier -c -p win32 -a x64 --insecure -n å¤å—å¸ˆå¤§åˆ·è„¸ç­¾åˆ° \"https://face.moyuyc.xyz/\" -i desktop/logos/logo.png --disable-dev-tools --disable-context-menu desktop",
"app:win64": "set ELECTRON_MIRROR=https://npm.taobao.org/mirrors/electron/ && nativefier -c -p win32 -a ia32 --insecure -n å¤å—å¸ˆå¤§åˆ·è„¸ç­¾åˆ° \"https://face.moyuyc.xyz/\" -i desktop/logos/logo.png --disable-dev-tools --disable-context-menu desktop",
```

### ä¸€é”®æ­å»ºç¯å¢ƒè„šæœ¬

```bash
// start.sh
// language: bash script
// env: bash
// usage: ./start.sh

#!/bin/bash
echoerr() { echo "$@" 1>&2; }
command_exists () { type "$1" &> /dev/null; }
command_exists_exit() {
    if ! command_exists "$1" ; then
        echoerr "${1} command not exists"
        exit
    fi
}

# å¿…é¡»çš„æŒ‡ä»¤æ£€æŸ¥ git npm node mysql
command_exists_exit git
command_exists_exit npm
command_exists_exit node
command_exists_exit mysql

# æ˜¯å¦å·²ç» clone è¿‡ï¼Œå·²ç» clone è¿‡ï¼Œåˆ™æ›´æ–°ä»£ç ï¼Œå¦åˆ™ clone
if [ -d face-njnu ]; then
    (cd face-njnu && git pull)
else
    git clone https://github.com/moyuyc/graduation-project.git face-njnu
fi

# è¦æ±‚è¾“å…¥ä¸‹è½½åŒå­¦çš„å…¥å­¦å¹´ä»½
read -p "which year do you want to download? (2013) [2013/n] " REPLY
if [[ $REPLY =~ ^[\s]*$ ]]; then
    YEAR=2013
    echo "Downloading... Year=$YEAR"
    (cd face-njnu/gp-image-download && ./download.sh $YEAR)
elif [[ $REPLY =~ ^[nN]$ ]]; then
    echo "Skipped Download Images"
else
    YEAR=$REPLY
    echo "Downloading... Year=$YEAR"
    (cd face-njnu/gp-image-download && ./download.sh $YEAR)
fi

echo "mysql data importing"
# æ˜¯å¦éœ€è¦å¯¼å…¥ sql æ•°æ®åˆ° mysql
read -p "Are you sure import sql data? [y/n]" REPLY
if [[ $REPLY =~ ^[yY]$ ]]; then
    # è¾“å…¥ mysql ç”¨æˆ·åï¼Œé»˜è®¤ root
    read -p "Username(root): " REPLY
    if [[ $REPLY =~ ^[\s]*$ ]]; then
        USER=root
    else
        USER=$REPLY
    fi

    mysql -u $USER -p gp < face-njnu/gp.sql
fi

# æ˜¯å¦éœ€è¦å®‰è£… opencv
read -p "Are you sure install opencv? [y/n]" REPLY
if [[ $REPLY =~ ^[yY]$ ]]; then
    if command_exists apt-get; then
        sudo apt-get install build-essential
        sudo apt-get install cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev
    fi

    if command_exists wget ; then
        wget -O ~/opencv.zip https://github.com/opencv/opencv/archive/2.4.13.1.zip
        unzip opencv.zip
        mv ~/opencv-2.4.13.1 ~/opencv
    else
        # git clone https://github.com/Itseez/opencv_contrib.git ~/opencv_contrib
        git clone https://github.com/opencv/opencv.git ~/opencv
        (cd ~/opencv && git checkout 2.4)
    fi
    (cd ~/opencv && rm -rf release && mkdir release \
        && cd release && \ # ~/opencv_contrib/modules:
        cmake -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local .. \
        && make \
        && sudo make install)
fi

if command_exists node-gyp ;
    npm install node-gyp -g --registry=https://registry.npm.taobao.org
fi

# å®‰è£…é¡¹ç›®ä¾èµ–ï¼Œå¹¶ä¸”å¯åŠ¨
cd face-njnu
npm install --registry=https://registry.npm.taobao.org
cd gp-njnu-photos-backend
npm install --registry=https://registry.npm.taobao.org
(cd opencv && npm run install )
npm run retrain && npm run start

```
## ç³»ç»Ÿæ¨¡å—ï¼ˆSystem Moduleï¼‰

![ç³»ç»Ÿæ¨¡å—](https://ooo.0o0.ooo/2017/01/22/58848833b7414.jpg)

# ç³»ç»Ÿæˆªå›¾ï¼ˆSystem Screenshotï¼‰

- å­¦ç”Ÿç­¾åˆ°
![å­¦ç”Ÿç­¾åˆ°-1](https://ooo.0o0.ooo/2017/01/22/588485d5c5134.jpg)
![å­¦ç”Ÿç­¾åˆ°-2](https://ooo.0o0.ooo/2017/01/22/58848618b06ff.jpg)

- äººè„¸å½•å…¥
![](https://ooo.0o0.ooo/2017/01/22/5884867e8c4f1.jpg)

- å…³äº
![](https://ooo.0o0.ooo/2017/01/22/588486cf622d8.jpg)

- ç®¡ç†å‘˜ç™»å½•
![](https://ooo.0o0.ooo/2017/01/22/588486ef8446d.jpg)

- ç®¡ç†å‘˜ç•Œé¢
![](https://ooo.0o0.ooo/2017/01/22/5884873f1e625.jpg)


# æ€»ç»“ï¼ˆSum Upï¼‰

å­¦ä¹ å¹¶ä¸”ä½¿ç”¨äº†ä¸€å¥—çš„ `webpack+react+redux+router`ï¼Œä»¥åŠåŒæ„æ¸²æŸ“ï¼›åŒæ—¶å·©å›ºäº†ä¸€äº› C ç³»åˆ—è¯­è¨€çŸ¥è¯†ï¼Œå°è¯•äº† node ä¸ C/C++ â€œé€šä¿¡â€çš„æ–¹å¼ï¼Œå…¥é—¨å­¦ä¹ äº† opencv ä»¥åŠäººè„¸å›¾åƒå¤„ç†ç›¸å…³çŸ¥è¯†ï¼›å°è¯•äº†ç«™ç‚¹çš„å‘å¸ƒï¼Œä¸ HTTPs çš„å‡çº§ã€‚å¯¹ å‰ç«¯/Nodejs/Web ä½“ç³»è®¤è¯†æ›´åŠ æ·±åˆ»ï¼Œå¯¹ unix æŒ‡ä»¤ç¯å¢ƒæ›´åŠ ç†Ÿæ‚‰ã€‚




